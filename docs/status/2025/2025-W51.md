---
status: working
scope: status
owner: core-team
last_reviewed: 2025-12-20
---

# 週次ステータス: 2025-W51 (12/16-12/22)

## サマリー

| 項目 | 値 |
|------|-----|
| 期間 | 2025-12-16 (月) 〜 2025-12-22 (日) |
| E2Eテスト | 216件パス（Phase 15.7で4件追加） |
| 主要完了Phase | Phase 13〜19 |

---

## 完了タスク

### 2025-12-20

#### チャットページフッターナビゲーション追加

**問題**: チャットビュー（一覧・個別）でフッターナビゲーションが表示されない

**修正内容**:
- `frontend/src/pages/shared/ItemChatPage.tsx`: FooterNav追加、入力エリアをフッター上に配置
- `frontend/src/pages/shared/ChatListPage.tsx`: Layoutコンポーネント使用でフッター表示

**コミット**: `a062897`

---

#### Phase 15.7: 残り対応による在庫・統計分離（実装完了）

**設計書**: [STAFF_RECORD_FORM_SPEC.md](../STAFF_RECORD_FORM_SPEC.md) セクション10

**概要**: 破棄/保存で在庫控除を分離し、廃棄量を記録

**実装内容**:

| 項目 | 内容 |
|------|------|
| 計算ロジック | 破棄時=提供量全て控除、保存時=食べた分のみ控除 |
| データ拡張 | `wastedQuantity`（廃棄量）を`ConsumptionLog`に追加 |
| UI更新 | StaffRecordDialogに控除後残量・廃棄量プレビュー表示 |
| API更新 | `remainingHandling` パラメータ追加、`inventoryDeducted`/`wastedQuantity` レスポンス追加 |

**計算ルール**:
- `discarded`（破棄）: 提供量全て在庫から引く、廃棄量 = 残った分
- `stored`/`other`（保存/その他）: 食べた分のみ在庫から引く、廃棄量 = 0
- 摂食割合100%: 提供量全て在庫から引く、廃棄量 = 0

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/utils/consumptionCalc.ts` | 計算関数追加 |
| `frontend/src/components/staff/StaffRecordDialog.tsx` | プレビュー表示追加 |
| `functions/src/types/index.ts` | `remainingHandling`型追加 |
| `functions/src/functions/recordConsumptionLog.ts` | 在庫計算ロジック更新 |
| `frontend/e2e/staff-record-form.spec.ts` | E2Eテスト4件追加（STAFF-050〜053） |

**コミット**: `ce07bf8`, `708fcc1`, `3923c82`

**本番E2E検証**: STAFF-050〜053 全てパス

---

#### デモモードチャット擬似動作・シードデータ対応

**問題**: デモモードでチャット送信時に500エラーが発生

**修正内容**:
- `frontend/src/data/demo/demoMessages.ts`: チャットシードデータ新規作成
- `frontend/src/pages/shared/ItemChatPage.tsx`: デモモード対応
- `frontend/src/pages/shared/ChatListPage.tsx`: デモモード対応

**コミット**: `647a21b`

---

#### getCareItems itemIdパラメータ対応

**問題**: チャット機能で品物情報取得時に500エラー

**修正内容**:
- `functions/src/types/index.ts`: `GetCareItemsRequest` に `itemId` フィールド追加
- `functions/src/functions/careItems.ts`: `itemId` 指定時は直接ドキュメント取得

**コミット**: `583905c`

---

#### Phase 19: 記録のチャット連携（実装完了）

**設計書**: [CHAT_INTEGRATION_SPEC.md](../CHAT_INTEGRATION_SPEC.md) セクション6

**概要**: 提供記録をチャットスレッドに自動反映

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `functions/src/functions/submitMealRecord.ts` | 記録保存時にチャットメッセージ自動作成 |
| `frontend/src/pages/shared/ItemChatPage.tsx` | RecordMessageCard追加 |
| `frontend/src/components/shared/NotificationSection.tsx` | 通知セクション（新規） |
| `frontend/src/pages/staff/StaffHome.tsx` | 通知セクション追加 |
| `frontend/src/pages/family/FamilyDashboard.tsx` | 通知セクション追加 |
| `frontend/e2e/record-chat-integration.spec.ts` | E2Eテスト8件 |

---

### 2025-12-19

#### Phase 18: チャット連携機能（実装完了）

**設計書**: [CHAT_INTEGRATION_SPEC.md](../CHAT_INTEGRATION_SPEC.md)

**概要**: 品物ごとのチャットスペースで、スタッフと家族が双方向にやりとりできる機能

**実装ファイル（バックエンド）**:
- `functions/src/types/index.ts` - チャット関連型定義追加
- `functions/src/functions/chat.ts` - チャットAPI（新規）

**実装ファイル（フロントエンド）**:
- `frontend/src/pages/shared/ChatListPage.tsx` - チャット一覧（新規）
- `frontend/src/pages/shared/ItemChatPage.tsx` - 品物チャット（新規）
- `frontend/src/components/FooterNav.tsx` - チャットタブ追加

---

#### Phase 13.2: スタッフ向けスケジュール表示強化

**設計書**: [ITEM_BASED_SNACK_RECORD_SPEC.md](../ITEM_BASED_SNACK_RECORD_SPEC.md) セクション4

**実装内容**:
- `scheduleUtils.ts` に表示用ヘルパー追加
- `WeekdayBadges.tsx` 曜日バッジコンポーネント
- `ScheduleDisplay.tsx` スケジュール表示統合

**E2Eテスト**: `schedule-display.spec.ts`（7件）

---

#### Phase 13.1: スケジュール拡張（家族用）

**設計書**: [ITEM_BASED_SNACK_RECORD_SPEC.md](../ITEM_BASED_SNACK_RECORD_SPEC.md) セクション3

**スケジュールタイプ**: once, daily, weekly, specific_dates

**E2Eテスト**: 7件全パス

---

#### Phase 13.0: 品物起点の間食記録UI実装

**設計書**: [ITEM_BASED_SNACK_RECORD_SPEC.md](../ITEM_BASED_SNACK_RECORD_SPEC.md) セクション2

**実装内容**:
- `MealInputTabs.tsx` - タブ切替コンポーネント
- `ItemBasedSnackRecord.tsx` - 品物リスト
- `SnackRecordModal.tsx` - 記録入力モーダル

**E2Eテスト**: 13件全パス

---

### 2025-12-18

#### Phase 17: Firebase Storage 写真連携（完了）

**設計書**: [FIREBASE_STORAGE_MIGRATION_SPEC.md](../FIREBASE_STORAGE_MIGRATION_SPEC.md)

**概要**: 写真保存先を Google Drive から Firebase Storage に移行

**実装ファイル**:
- `storage.rules` - Firebase Storage セキュリティルール
- `functions/src/services/storageService.ts` - Storage操作サービス
- `functions/src/functions/uploadCareImage.ts` - Drive → Storage に移行
- `functions/src/functions/getCarePhotos.ts` - 写真取得API

---

#### Phase 16: 写真エビデンス表示機能（完了）

**設計書**: [PHOTO_EVIDENCE_DISPLAY_SPEC.md](../PHOTO_EVIDENCE_DISPLAY_SPEC.md)

**概要**: スタッフがアップロードした写真を家族画面で表示

**E2Eテスト**: 5件パス

---

#### Phase 15: スタッフ用記録入力フォーム統一（完了）

**設計書**: [STAFF_RECORD_FORM_SPEC.md](../STAFF_RECORD_FORM_SPEC.md)

**実装内容**:
- タブ削除、統一フォーム
- 摂食割合の数値入力（0-10）
- 残った分への対応フィールド

**E2Eテスト**: 22件

---

#### Phase 14: スタッフ用デモページ（完了）

**設計書**: [DEMO_STAFF_SPEC.md](../archive/DEMO_STAFF_SPEC.md)

**実装内容**:
- `DemoStaffHome.tsx` - スタッフ用デモホーム
- `DemoStaffShowcase.tsx` - スタッフ用ガイドツアー

**E2Eテスト**: 17件追加

---

#### Phase 12: FIFO・プリセット保存提案（完了）

**設計書**: [FIFO_DESIGN_SPEC.md](../FIFO_DESIGN_SPEC.md)

**機能**:
- FIFOソート（期限が近い順に表示）
- FIFOWarning（同一品物複数時に推奨マーク表示）
- 手動登録時プリセット保存提案

**E2Eテスト**: 10件

---

#### Phase 11: FoodMaster食品マスタ実装

**設計書**: [INVENTORY_CONSUMPTION_SPEC.md](../INVENTORY_CONSUMPTION_SPEC.md) セクション2.2

**機能**:
- 食品マスタCRUD API
- AI提案のキャッシュ機能
- 自動蓄積（Phase 11.1）

---

#### 間食記録連携機能 - 全Phase完了

**設計書**: [SNACK_RECORD_INTEGRATION_SPEC.md](../SNACK_RECORD_INTEGRATION_SPEC.md)

Phase 1-6 全て完了

---

### 2025-12-17

#### Phase 9.3: 統計ダッシュボード拡張

- 在庫サマリーAPI実装
- 食品傾向分析API実装
- 摂食傾向タブ実装

---

#### Phase 9.x: 禁止ルール機能完全実装

**設計書**: [ITEM_MANAGEMENT_SPEC.md](../ITEM_MANAGEMENT_SPEC.md) セクション8

**機能**:
- 禁止ルールCRUD API
- 家族向け「入居者設定」画面
- スタッフ向け禁止品目警告表示

---

#### Phase 9.2: ConsumptionLog API・UI実装

**設計書**: [INVENTORY_CONSUMPTION_SPEC.md](../INVENTORY_CONSUMPTION_SPEC.md)

**機能**:
- 消費ログ記録API
- 残量の自動計算と更新
- タイムライン形式での履歴表示

---

### 2025-12-16

#### Phase 9.1: バグ修正 - useStats無限ループ

**問題**: 統計ビュー（/stats）が停止
**原因**: `useEffect`の無限ループ
**修正**: `useRef`で初回値を固定

---

#### Phase 9.0/9.1: 在庫・消費追跡システム設計・実装

**設計書**: [INVENTORY_CONSUMPTION_SPEC.md](../INVENTORY_CONSUMPTION_SPEC.md)

- View構成設計
- ItemTimeline.tsx（品物タイムライン）
- ルーティング整備

---

#### Phase 8.6/8.7: プリセット管理・AI自動ストック

**設計書**: [PRESET_MANAGEMENT_SPEC.md](../PRESET_MANAGEMENT_SPEC.md)

- プリセット管理画面
- AI提案保存ダイアログ

---

## 関連ドキュメント

- [CURRENT_STATUS.md](../CURRENT_STATUS.md) - 現在のステータス
- [HANDOVER.md](../HANDOVER.md) - 引き継ぎドキュメント
- [ROADMAP.md](../ROADMAP.md) - 開発ロードマップ
