---
status: working
scope: status
owner: core-team
last_reviewed: 2025-12-21
---

# 週次ステータス: 2025-W51 (12/16-12/22)

## サマリー

| 項目 | 値 |
|------|-----|
| 期間 | 2025-12-16 (月) 〜 2025-12-22 (日) |
| E2Eテスト | 323件（13件スキップ）|
| 主要完了Phase | Phase 13〜36 |

---

## 完了タスク

### 2025-12-21

#### Phase 36: スケジュール開始日・品物編集スケジュール対応（実装完了）

**設計書**: [ITEM_BASED_SNACK_RECORD_SPEC.md](../ITEM_BASED_SNACK_RECORD_SPEC.md) セクション5

**概要**: 毎日・曜日指定スケジュールタイプに開始日（startDate）フィールドを追加。品物編集ページでスケジュール変更対応。

**修正内容**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/types/careItem.ts` | ServingScheduleにstartDate追加 |
| `functions/src/types/index.ts` | ServingScheduleにstartDate追加 |
| `frontend/src/utils/scheduleUtils.ts` | 開始日チェック追加 |
| `functions/src/utils/scheduleUtils.ts` | 新規: サーバーサイド判定ロジック |
| `functions/src/functions/taskGenerator.ts` | 構造化スケジュール対応 |
| `frontend/src/components/family/ServingScheduleInput.tsx` | 開始日UI追加 |
| `frontend/src/pages/family/ItemEditPage.tsx` | スケジュール編集対応 |
| `frontend/src/components/meal/ScheduleDisplay.tsx` | 開始日表示追加 |

**E2Eテスト**: schedule-start-date.spec.ts（13件追加）

**本番デプロイ**: 完了

---

#### Phase 35: 同期間隔調整（実装完了）

**概要**: 差分同期の間隔を15分から1時間に変更。GAS側との整合性確保。

**修正内容**:

| ファイル | 変更内容 |
|----------|----------|
| `functions/src/functions/syncManager.ts` | `SYNC_INTERVAL_MS` を15分→60分に変更 |

**背景**: GAS（スプレッドシート側）の同期間隔と統一することで、不要な同期リクエストを削減

**本番デプロイ**: 完了

---

#### Phase 34: AI分析デモモード対応（実装完了）

**設計書**: [DEMO_AI_ANALYSIS_SPEC.md](../DEMO_AI_ANALYSIS_SPEC.md)

**概要**: 統計ダッシュボードのAI分析機能がデモモードで動作するように修正

**問題**: `/demo/stats` ページでAI分析ボタンをクリックすると "AI analysis unavailable, using defaults" エラーが発生

**原因**: `AIAnalysis.tsx` コンポーネントがデモモードを考慮せず、常に `aiAnalyze` APIを呼び出していた

**修正内容**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/data/demo/demoStats.ts` | `DEMO_AI_ANALYSIS` モックデータ追加 |
| `frontend/src/components/family/AIAnalysis.tsx` | デモモード判定追加、モックデータ使用 |
| `frontend/e2e/demo-stats-ai.spec.ts` | E2Eテスト9件追加 |

**モックデータ構成**:
- summary: 過去30日間の摂食傾向分析サマリー
- findings: ポジティブ2件、ネガティブ1件、中立1件
- suggestions: 高優先度1件、中優先度1件、低優先度1件

**E2Eテスト**: demo-stats-ai.spec.ts（9件）
- DEMO-STATS-AI-001〜009（AI分析パネル表示、分析実行、結果表示等）

**コミット**: 該当コミット

**本番デプロイ**: 完了

---

#### Phase 33: 残ったものへの処置指示（実装完了）

**設計書**: [REMAINING_HANDLING_INSTRUCTION_SPEC.md](../REMAINING_HANDLING_INSTRUCTION_SPEC.md)

**概要**: 家族が品物登録時に「食べ残した場合の処置」を事前に指定でき、スタッフが記録時にその指示を確認できる

**実装内容**:

| 項目 | 内容 |
|------|------|
| 家族側 | 品物登録/編集時に「残った場合の対応」フィールド追加 |
| スタッフ側 | 記録ダイアログに家族の指示バナー表示 |
| 選択肢ガイド | 家族指示に基づく推奨・非推奨の視覚表示 |

**選択肢**:
- `stored`: 保存してください（🔵推奨）
- `discarded`: 破棄してください（🔴推奨）
- （未設定時はガイド表示なし）

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/types/careItem.ts` | `remainingHandlingInstruction` 型追加 |
| `frontend/src/pages/family/ItemForm.tsx` | 選択UIコンポーネント追加 |
| `frontend/src/pages/family/ItemEditPage.tsx` | 選択UIコンポーネント追加 |
| `frontend/src/components/staff/StaffRecordDialog.tsx` | 家族指示バナー表示、選択肢ガイド |
| `frontend/src/data/demo/demoCareItems.ts` | デモデータに処置指示追加 |
| `frontend/e2e/remaining-handling-instruction.spec.ts` | E2Eテスト10件追加 |

**E2Eテスト**: remaining-handling-instruction.spec.ts（10件）
- RHI-001〜010（家族登録、スタッフ表示、推奨ガイド等）

**コミット**: 該当コミット

**本番デプロイ**: 完了

---

#### Phase 32: 統計ダッシュボード品物別分布（実装完了）

**概要**: 統計ダッシュボードの「カテゴリ別分布」を「品物別分布」に変更

**変更理由**: Phase 31でカテゴリが2種類（食べ物/飲み物）に簡素化されたため、カテゴリ別分布の意味が薄れた

**実装内容**:

| 項目 | 変更前 | 変更後 |
|------|--------|--------|
| グラフタイトル | カテゴリ別分布 | 品物別分布 |
| データソース | カテゴリごとの集計 | 品物名ごとの集計 |
| 表示内容 | 7カテゴリの円グラフ | 個別品物の消費傾向 |

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/pages/shared/StatsDashboard.tsx` | グラフデータ計算ロジック変更 |
| `frontend/src/data/demo/demoStats.ts` | デモデータ更新 |

**コミット**: 該当コミット

**本番デプロイ**: 完了

---

#### Phase 31: カテゴリ簡素化 + タブ固定化（実装完了）

**設計書**:
- [ITEM_MANAGEMENT_SPEC.md](../ITEM_MANAGEMENT_SPEC.md) セクション2.2
- [STAFF_RECORD_FORM_SPEC.md](../STAFF_RECORD_FORM_SPEC.md) タブ固定動作

**概要**: 品物カテゴリを7種類から2種類（食べ物/飲み物）に簡素化し、スタッフ記録フォームのタブ切替を廃止

**変更内容**:

| 変更前（7カテゴリ） | 変更後（2カテゴリ） |
|---------------------|---------------------|
| fruit, snack, dairy, prepared, supplement, other | food（食べ物） |
| drink | drink（飲み物） |

**スタッフ記録フォームの動作変更**:

| カテゴリ | 表示フォーム | タブ切替 |
|----------|-------------|----------|
| 食べ物 (food) | 食事フォーム（摂食割合入力） | ❌ 不可 |
| 飲み物 (drink) | 水分フォーム（cc入力） | ❌ 不可 |

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/types/careItem.ts` | ItemCategory型を2値に変更、migrateCategory()追加 |
| `functions/src/types/index.ts` | ItemCategory型を2値に変更 |
| `frontend/src/components/staff/StaffRecordDialog.tsx` | タブ切替を廃止、固定ヘッダー表示 |
| `frontend/src/pages/family/ItemForm.tsx` | カテゴリ選択UI: 7ボタン→2ボタン |
| `frontend/src/pages/family/ItemEditPage.tsx` | カテゴリ選択UI: 7ボタン→2ボタン |
| `frontend/src/pages/shared/StatsDashboard.tsx` | 統計の2カテゴリ対応 |
| `functions/src/services/googleChatService.ts` | 通知メッセージのカテゴリラベル更新 |
| `frontend/src/data/demo/demoCareItems.ts` | デモデータを2カテゴリに更新 |
| `frontend/src/data/demo/demoStats.ts` | 統計デモデータを2カテゴリに更新 |

**後方互換性**: `migrateCategory()`関数で旧カテゴリを自動変換（drink→drink、その他→food）

**コミット**: `50cfc2c`

**本番デプロイ**: 完了

---

#### Phase 30: 入力無し警告の実装確認

**確認結果**: ✅ 要件通りに実装済み

**ユーザー要件**:
> このアプリから食事または水分の入力が１回でも有ったかをトリガー条件としたい（スプレッドシートからの取得情報は使わない）

**実装確認**:

```
submitMealRecord API成功 → updateDailyRecordLog("meal") → hasMealRecord=true
submitHydrationRecord API成功 → updateDailyRecordLog("hydration") → hasHydrationRecord=true

毎日16:00 JST: checkDailyRecords
  ↓
Firestore daily_record_logs/{date} を読み取り
  ↓
hasMealRecord==false または hasHydrationRecord==false → Google Chat警告通知
```

**結論**: スプレッドシートは一切参照せず、アプリからの入力APIのみでフラグを更新

---

#### Phase 29: 水分記録機能（実装完了）

**設計書**: [STAFF_RECORD_FORM_SPEC.md](../STAFF_RECORD_FORM_SPEC.md) セクション13

**概要**: スタッフ記録ダイアログをタブ式UIに変更し、水分摂取量を専用シートに記録

**実装内容**:

| 項目 | 内容 |
|------|------|
| タブ式UI | 食事🍪 / 水分💧の2タブ切替 |
| デフォルトタブ | drinkカテゴリ→水分タブ、その他→食事タブ |
| 水分量自動計算 | ml/cc/l/コップ単位から自動計算 |
| 残り対応 | 水分タブにも「残った分への対応」追加（食事タブと同仕様） |
| スプレッドシート連携 | 水分摂取量シート（`1su5K9TjmzMfKc8OIK2aZYXCfuDrNeIRM0a3LUCFcct4`）|
| Webhook | #水分摂取💧タグ付き通知 |

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/components/staff/StaffRecordDialog.tsx` | タブ式UI、水分量計算、残り対応 |
| `functions/src/functions/submitHydrationRecord.ts` | Cloud Function（新規） |
| `functions/src/config/sheets.ts` | SHEET_HYDRATION設定追加 |
| `frontend/e2e/staff-record-form.spec.ts` | E2Eテスト17件追加 |

**コミット**: `9ff6af0`, `204c04a`

**E2E検証**: 302件（26件スキップ含む）全パス

---

#### Phase 30: 家族操作・入力無し通知（実装完了）

**設計書**: [FAMILY_NOTIFY_SPEC.md](../FAMILY_NOTIFY_SPEC.md)

**概要**: 家族による品物操作時の即座通知、毎日16時の入力無しチェック通知

**通知トリガー**:

| トリガー | タイミング | 条件 |
|----------|------------|------|
| 品物登録 | submitCareItem成功時 | 即座 |
| 品物編集 | updateCareItem成功時 | 即座 |
| 入力無し警告 | 毎日16:00 JST | その日の食事/水分記録が未入力 |

**実装内容**:

| 項目 | 内容 |
|------|------|
| 設定UI | 管理者設定モーダルに「監視通知Webhook URL」追加 |
| Firestoreコレクション | `daily_record_logs` 新規追加 |
| Cloud Scheduler | `checkDailyRecords` 毎日16:00 JST実行 |
| メッセージタグ | #品物登録📦、#品物編集✏️、#入力無し警告⚠️ |

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/components/MealSettingsModal.tsx` | 監視通知Webhook URL設定UI追加 |
| `frontend/src/types/index.ts` | `familyNotifyWebhookUrl` 型追加 |
| `functions/src/functions/careItems.ts` | 品物登録/編集時に通知送信 |
| `functions/src/functions/checkDailyRecords.ts` | 16時定時チェック関数（新規） |
| `functions/src/services/dailyRecordLogService.ts` | 日次ログサービス（新規） |
| `functions/src/services/googleChatService.ts` | フォーマット関数追加 |
| `frontend/e2e/family-notify.spec.ts` | E2Eテスト7件追加 |

**コミット**: 該当コミット

**E2E検証**: 309件（28件スキップ含む）全パス

---

#### Phase 30.1: 通知機能拡張（実装完了）

**設計書**: [FAMILY_NOTIFY_SPEC.md](../FAMILY_NOTIFY_SPEC.md)

**概要**: 品物削除時のGoogle Chat通知追加、記録チェック通知時間の管理画面設定対応

**変更内容**:

| 項目 | 内容 |
|------|------|
| 品物削除通知 | 削除成功時にGoogle Chat通知（#品物削除🗑️タグ） |
| 通知時刻設定 | 管理画面で0-23時から選択可能（デフォルト16時） |
| Cloud Scheduler | `0 * * * *`（毎時0分）に変更、設定時刻と比較して実行 |

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `functions/src/types/index.ts` | `recordCheckHour` フィールド追加 |
| `frontend/src/types/index.ts` | `recordCheckHour` フィールド追加 |
| `functions/src/functions/careItems.ts` | 削除時通知ロジック追加 |
| `functions/src/functions/checkDailyRecords.ts` | 毎時実行＋時間比較ロジック |
| `functions/src/services/googleChatService.ts` | `formatCareItemNotification`で'delete'サポート |
| `frontend/src/components/MealSettingsModal.tsx` | 通知時間セレクトボックス追加 |

**コミット**: `e40655a`

**本番デプロイ**: 完了

---

#### Phase 37: プリセット管理へのアクセス改善（実装完了）

**設計書**: [PRESET_MANAGEMENT_SPEC.md](../PRESET_MANAGEMENT_SPEC.md) セクション5.1

**概要**: 「いつもの指示」（プリセット管理）ページへのナビゲーションを改善

**変更内容**:

| 項目 | 内容 |
|------|------|
| ナビゲーションリンク | 品物管理ページのヘッダーに「⭐ いつもの指示」ボタン追加 |
| レスポンシブ対応 | モバイル: アイコン（⭐）のみ、タブレット以上: テキスト表示 |
| デモ/本番両対応 | `pathPrefix` を使用してパス生成 |

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/pages/family/ItemManagement.tsx` | ヘッダーにプリセット管理リンク追加 |
| `frontend/e2e/preset-navigation.spec.ts` | E2Eテスト5件追加 |

**E2Eテスト**:
- PRESET-NAV-001: リンク表示確認
- PRESET-NAV-002: 遷移確認
- PRESET-NAV-003: デモモード動作確認
- PRESET-NAV-004: 本番モード動作確認
- PRESET-NAV-005: レスポンシブ表示確認

**本番デプロイ**: 完了

---

#### Phase 23-28: UX/UI改善（実装完了）

| Phase | 内容 | コミット |
|-------|------|----------|
| Phase 23 | 日時カラムのソートを正確な時系列順に修正 | 該当コミット |
| Phase 24 | テーブルビューのカラム幅リサイズ機能 | 該当コミット |
| Phase 25 | テーブルビューの全文検索機能 | 該当コミット |
| Phase 26 | 入居者設定（禁止ルールUI）一時非表示 | 該当コミット |
| Phase 27 | FamilyDashboardレイアウト改善 | 該当コミット |
| Phase 28 | 提供方法選択肢から「冷やす」「ミキサー」削除 | 該当コミット |

---

#### UX改善: 冗長な「タイムラインを見る」リンク削除

**コミット**: `e4eede4`

**概要**: 品物詳細ページ内の「タイムラインを見る」リンクカードを削除

**理由**: 「タイムライン（履歴）」セクションで同じ情報を表示しているため冗長

**変更ファイル**:
| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/pages/family/ItemDetail.tsx` | 別ページ遷移リンク削除 |
| `docs/VIEW_ARCHITECTURE_SPEC.md` | セクション4.3に変更点追記 |
| `docs/ITEM_MANAGEMENT_SPEC.md` | セクション9.4.4に変更点追記 |

---

#### Phase 22.3拡張: 編集履歴デモデータ追加

**コミット**: `41c1dfc`

**概要**: 品物の編集履歴をタイムラインで表示するデモデータを追加

**実装ファイル**:
| ファイル | 内容 |
|----------|------|
| `frontend/src/types/itemEvent.ts` | ItemEvent型定義、ヘルパー関数 |
| `frontend/src/data/demo/demoItemEvents.ts` | 編集履歴デモデータ（18イベント） |
| `frontend/src/hooks/useItemEvents.ts` | 品物イベント取得フック |
| `frontend/src/pages/family/ItemDetail.tsx` | 編集イベントをタイムラインに統合表示 |
| `frontend/e2e/item-edit.spec.ts` | E2Eテスト+2件（変更内容・実行者表示確認） |

**E2E検証**: 267件（16件スキップ含む）全パス

---

#### Phase 22: 品物編集機能（実装完了）

**設計書**: [ITEM_MANAGEMENT_SPEC.md](../ITEM_MANAGEMENT_SPEC.md) セクション9

**概要**: 家族向け品物編集機能を追加

**実装内容**:

| Phase | 内容 |
|-------|------|
| 22.1 | 品物編集UI（ItemEditPage.tsx）実装 |
| 22.2 | タイムスタンプ表示（登録日時・更新日時） |
| 22.3 | 編集履歴タイムライン表示（タイムラインセクション、data-testid追加） |

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/pages/family/ItemEditPage.tsx` | 品物編集ページ（新規） |
| `frontend/src/pages/family/ItemDetail.tsx` | 編集ボタン追加、タイムライン統合 |
| `frontend/src/App.tsx` | `/family/items/:id/edit` ルート追加 |
| `docs/ITEM_MANAGEMENT_SPEC.md` | Phase 22仕様追加（セクション9） |
| `frontend/e2e/item-edit.spec.ts` | E2Eテスト23件 |

**コミット**: `e5fb97a` (Phase 22), `6efa8fd` (Phase 22.3), `41c1dfc` (デモデータ), `e4eede4` (UX改善)

**E2E検証**: 267件（16件スキップ含む）全パス

---

#### Phase 21: チャット機能一時非表示（実装完了）

**設計書**: [CHAT_FEATURE_HIDE_SPEC.md](../CHAT_FEATURE_HIDE_SPEC.md)

**概要**: 内部チャット機能（スタッフ⇔家族間）を一時的に非表示化

**実装内容**:

| 項目 | 内容 |
|------|------|
| FooterNav.tsx | チャットタブ（家族・スタッフ両方）をコメントアウト |
| App.tsx | チャット関連ルート10件をコメントアウト |
| ItemDetail.tsx | 「スタッフにチャット」ボタン非表示 |
| FamilyMessageDetail.tsx | 「家族とチャット」ボタン非表示 |
| FamilyDashboard/StaffHome | NotificationSection非表示 |
| E2Eテスト | chat-integration.spec.ts, record-chat-integration.spec.ts をスキップ |

**注意**: Google Chat Webhook（外部通知）は非表示対象外

**コミット**: `78d2f38`

**E2E検証**: 233件パス + 16件スキップ

---

### 2025-12-20

#### チャットページフッターナビゲーション追加

**問題**: チャットビュー（一覧・個別）でフッターナビゲーションが表示されない

**修正内容**:
- `frontend/src/pages/shared/ItemChatPage.tsx`: FooterNav追加、入力エリアをフッター上に配置
- `frontend/src/pages/shared/ChatListPage.tsx`: Layoutコンポーネント使用でフッター表示

**コミット**: `a062897`

---

#### Phase 15.7: 残り対応による在庫・統計分離（実装完了）

**設計書**: [STAFF_RECORD_FORM_SPEC.md](../STAFF_RECORD_FORM_SPEC.md) セクション10

**概要**: 破棄/保存で在庫控除を分離し、廃棄量を記録

**実装内容**:

| 項目 | 内容 |
|------|------|
| 計算ロジック | 破棄時=提供量全て控除、保存時=食べた分のみ控除 |
| データ拡張 | `wastedQuantity`（廃棄量）を`ConsumptionLog`に追加 |
| UI更新 | StaffRecordDialogに控除後残量・廃棄量プレビュー表示 |
| API更新 | `remainingHandling` パラメータ追加、`inventoryDeducted`/`wastedQuantity` レスポンス追加 |

**計算ルール**:
- `discarded`（破棄）: 提供量全て在庫から引く、廃棄量 = 残った分
- `stored`/`other`（保存/その他）: 食べた分のみ在庫から引く、廃棄量 = 0
- 摂食割合100%: 提供量全て在庫から引く、廃棄量 = 0

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `frontend/src/utils/consumptionCalc.ts` | 計算関数追加 |
| `frontend/src/components/staff/StaffRecordDialog.tsx` | プレビュー表示追加 |
| `functions/src/types/index.ts` | `remainingHandling`型追加 |
| `functions/src/functions/recordConsumptionLog.ts` | 在庫計算ロジック更新 |
| `frontend/e2e/staff-record-form.spec.ts` | E2Eテスト4件追加（STAFF-050〜053） |

**コミット**: `ce07bf8`, `708fcc1`, `3923c82`

**本番E2E検証**: STAFF-050〜053 全てパス

---

#### Phase 15.8: ベースページ簡素化（実装完了）

**設計書**: [STAFF_RECORD_FORM_SPEC.md](../STAFF_RECORD_FORM_SPEC.md) セクション11

**概要**: MealInputPage.tsxを大幅簡素化（407行→122行）

**実装内容**:
- フォーム要素を削除し、品物リスト表示のみに特化
- 入力は各品物のStaffRecordDialogで完結

**E2Eテスト**: STAFF-060〜064（5件追加）

**コミット**: `14b61a8`

---

#### Phase 15.9: 写真アップロードUI（実装完了）

**設計書**: [STAFF_RECORD_FORM_SPEC.md](../STAFF_RECORD_FORM_SPEC.md) セクション12

**概要**: StaffRecordDialogに写真アップロード機能を追加

**実装内容**:
- 写真選択・プレビュー・削除機能
- uploadCareImage API呼び出し
- Firebase Storage連携、photoUrl取得
- submitMealRecordにphotoUrlを渡す

**E2Eテスト**: STAFF-009, STAFF-070〜072（4件追加）

**コミット**: `2bd7bff`, `1ee4518`

---

#### Phase 20: デモ環境完結（離脱防止）（実装完了）

**設計書**: [DEMO_STAFF_CONTAINMENT.md](../DEMO_STAFF_CONTAINMENT.md)

**概要**: スタッフデモから本番環境への意図しない離脱を防止

**実装内容**:
- MealInputPage.tsx: 戻るボタンをデモモード対応
- ItemTimeline.tsx: リンクをデモモード対応
- App.tsx: /demo/staff/statsルート追加

**E2Eテスト**: demo-staff-containment.spec.ts（15件追加）

**コミット**: `d4c2fe1`

---

#### Phase 20.1: デモモードAPI 500エラー修正（実装完了）

**設計書**: [FOOTERNAV_DEMO_FIX_SPEC.md](../FOOTERNAV_DEMO_FIX_SPEC.md)

**概要**: デモページでのgetActiveChatItems/getNotifications 500エラーを修正

**実装内容**:
- FooterNav.tsx: デモモードでAPI呼び出しスキップ、ダミーデータ使用
- NotificationSection.tsx: デモモードでAPI呼び出しスキップ、ダミー通知表示
- firestore.indexes.json: 複合インデックス2件追加

**E2Eテスト**: footer-nav-demo.spec.ts（9件追加）

**コミット**: `29570f7`

---

#### デモモードチャット擬似動作・シードデータ対応

**問題**: デモモードでチャット送信時に500エラーが発生

**修正内容**:
- `frontend/src/data/demo/demoMessages.ts`: チャットシードデータ新規作成
- `frontend/src/pages/shared/ItemChatPage.tsx`: デモモード対応
- `frontend/src/pages/shared/ChatListPage.tsx`: デモモード対応

**コミット**: `647a21b`

---

#### getCareItems itemIdパラメータ対応

**問題**: チャット機能で品物情報取得時に500エラー

**修正内容**:
- `functions/src/types/index.ts`: `GetCareItemsRequest` に `itemId` フィールド追加
- `functions/src/functions/careItems.ts`: `itemId` 指定時は直接ドキュメント取得

**コミット**: `583905c`

---

#### Phase 19: 記録のチャット連携（実装完了）

**設計書**: [CHAT_INTEGRATION_SPEC.md](../CHAT_INTEGRATION_SPEC.md) セクション6

**概要**: 提供記録をチャットスレッドに自動反映

**実装ファイル**:

| ファイル | 変更内容 |
|----------|----------|
| `functions/src/functions/submitMealRecord.ts` | 記録保存時にチャットメッセージ自動作成 |
| `frontend/src/pages/shared/ItemChatPage.tsx` | RecordMessageCard追加 |
| `frontend/src/components/shared/NotificationSection.tsx` | 通知セクション（新規） |
| `frontend/src/pages/staff/StaffHome.tsx` | 通知セクション追加 |
| `frontend/src/pages/family/FamilyDashboard.tsx` | 通知セクション追加 |
| `frontend/e2e/record-chat-integration.spec.ts` | E2Eテスト8件 |

---

### 2025-12-19

#### Phase 18: チャット連携機能（実装完了）

**設計書**: [CHAT_INTEGRATION_SPEC.md](../CHAT_INTEGRATION_SPEC.md)

**概要**: 品物ごとのチャットスペースで、スタッフと家族が双方向にやりとりできる機能

**実装ファイル（バックエンド）**:
- `functions/src/types/index.ts` - チャット関連型定義追加
- `functions/src/functions/chat.ts` - チャットAPI（新規）

**実装ファイル（フロントエンド）**:
- `frontend/src/pages/shared/ChatListPage.tsx` - チャット一覧（新規）
- `frontend/src/pages/shared/ItemChatPage.tsx` - 品物チャット（新規）
- `frontend/src/components/FooterNav.tsx` - チャットタブ追加

---

#### Phase 13.2: スタッフ向けスケジュール表示強化

**設計書**: [ITEM_BASED_SNACK_RECORD_SPEC.md](../ITEM_BASED_SNACK_RECORD_SPEC.md) セクション4

**実装内容**:
- `scheduleUtils.ts` に表示用ヘルパー追加
- `WeekdayBadges.tsx` 曜日バッジコンポーネント
- `ScheduleDisplay.tsx` スケジュール表示統合

**E2Eテスト**: `schedule-display.spec.ts`（7件）

---

#### Phase 13.1: スケジュール拡張（家族用）

**設計書**: [ITEM_BASED_SNACK_RECORD_SPEC.md](../ITEM_BASED_SNACK_RECORD_SPEC.md) セクション3

**スケジュールタイプ**: once, daily, weekly, specific_dates

**E2Eテスト**: 7件全パス

---

#### Phase 13.0: 品物起点の間食記録UI実装

**設計書**: [ITEM_BASED_SNACK_RECORD_SPEC.md](../ITEM_BASED_SNACK_RECORD_SPEC.md) セクション2

**実装内容**:
- `MealInputTabs.tsx` - タブ切替コンポーネント
- `ItemBasedSnackRecord.tsx` - 品物リスト
- `SnackRecordModal.tsx` - 記録入力モーダル

**E2Eテスト**: 13件全パス

---

### 2025-12-18

#### Phase 17: Firebase Storage 写真連携（完了）

**設計書**: [FIREBASE_STORAGE_MIGRATION_SPEC.md](../FIREBASE_STORAGE_MIGRATION_SPEC.md)

**概要**: 写真保存先を Google Drive から Firebase Storage に移行

**実装ファイル**:
- `storage.rules` - Firebase Storage セキュリティルール
- `functions/src/services/storageService.ts` - Storage操作サービス
- `functions/src/functions/uploadCareImage.ts` - Drive → Storage に移行
- `functions/src/functions/getCarePhotos.ts` - 写真取得API

---

#### Phase 16: 写真エビデンス表示機能（完了）

**設計書**: [PHOTO_EVIDENCE_DISPLAY_SPEC.md](../PHOTO_EVIDENCE_DISPLAY_SPEC.md)

**概要**: スタッフがアップロードした写真を家族画面で表示

**E2Eテスト**: 5件パス

---

#### Phase 15: スタッフ用記録入力フォーム統一（完了）

**設計書**: [STAFF_RECORD_FORM_SPEC.md](../STAFF_RECORD_FORM_SPEC.md)

**実装内容**:
- タブ削除、統一フォーム
- 摂食割合の数値入力（0-10）
- 残った分への対応フィールド

**E2Eテスト**: 22件

---

#### Phase 14: スタッフ用デモページ（完了）

**設計書**: [DEMO_STAFF_SPEC.md](../archive/DEMO_STAFF_SPEC.md)

**実装内容**:
- `DemoStaffHome.tsx` - スタッフ用デモホーム
- `DemoStaffShowcase.tsx` - スタッフ用ガイドツアー

**E2Eテスト**: 17件追加

---

#### Phase 12: FIFO・プリセット保存提案（完了）

**設計書**: [FIFO_DESIGN_SPEC.md](../FIFO_DESIGN_SPEC.md)

**機能**:
- FIFOソート（期限が近い順に表示）
- FIFOWarning（同一品物複数時に推奨マーク表示）
- 手動登録時プリセット保存提案

**E2Eテスト**: 10件

---

#### Phase 11: FoodMaster食品マスタ実装

**設計書**: [INVENTORY_CONSUMPTION_SPEC.md](../INVENTORY_CONSUMPTION_SPEC.md) セクション2.2

**機能**:
- 食品マスタCRUD API
- AI提案のキャッシュ機能
- 自動蓄積（Phase 11.1）

---

#### 間食記録連携機能 - 全Phase完了

**設計書**: [SNACK_RECORD_INTEGRATION_SPEC.md](../SNACK_RECORD_INTEGRATION_SPEC.md)

Phase 1-6 全て完了

---

### 2025-12-17

#### Phase 9.3: 統計ダッシュボード拡張

- 在庫サマリーAPI実装
- 食品傾向分析API実装
- 摂食傾向タブ実装

---

#### Phase 9.x: 禁止ルール機能完全実装

**設計書**: [ITEM_MANAGEMENT_SPEC.md](../ITEM_MANAGEMENT_SPEC.md) セクション8

**機能**:
- 禁止ルールCRUD API
- ~~家族向け「入居者設定」画面~~ ※Phase 26で削除
- スタッフ向け禁止品目警告表示

---

#### Phase 9.2: ConsumptionLog API・UI実装

**設計書**: [INVENTORY_CONSUMPTION_SPEC.md](../INVENTORY_CONSUMPTION_SPEC.md)

**機能**:
- 消費ログ記録API
- 残量の自動計算と更新
- タイムライン形式での履歴表示

---

### 2025-12-16

#### Phase 9.1: バグ修正 - useStats無限ループ

**問題**: 統計ビュー（/stats）が停止
**原因**: `useEffect`の無限ループ
**修正**: `useRef`で初回値を固定

---

#### Phase 9.0/9.1: 在庫・消費追跡システム設計・実装

**設計書**: [INVENTORY_CONSUMPTION_SPEC.md](../INVENTORY_CONSUMPTION_SPEC.md)

- View構成設計
- ItemTimeline.tsx（品物タイムライン）
- ルーティング整備

---

#### Phase 8.6/8.7: プリセット管理・AI自動ストック

**設計書**: [PRESET_MANAGEMENT_SPEC.md](../PRESET_MANAGEMENT_SPEC.md)

- プリセット管理画面
- AI提案保存ダイアログ

---

## 関連ドキュメント

- [CURRENT_STATUS.md](../CURRENT_STATUS.md) - 現在のステータス
- [HANDOVER.md](../HANDOVER.md) - 引き継ぎドキュメント
- [ROADMAP.md](../ROADMAP.md) - 開発ロードマップ
