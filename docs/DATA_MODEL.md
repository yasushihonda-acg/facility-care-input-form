---
status: working
scope: data
owner: core-team
last_reviewed: 2026-01-03
links:
  - docs/archive/SHEET_A_STRUCTURE.md
  - docs/archive/SHEET_B_STRUCTURE.md
  - docs/API_SPEC.md
---

# ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

> **çµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ãƒ‡ãƒ¼ã‚¿æ§‹é€ é–¢é€£ä»•æ§˜ã‚’é›†ç´„ã—ãŸåŒ…æ‹¬çš„ãªã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

---

## 1. æ¦‚è¦

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ï¼š

| ã‚¹ãƒˆã‚¢ | ç”¨é€” | å‚™è€ƒ |
|--------|------|------|
| **Google Sheets** | ã‚±ã‚¢è¨˜éŒ²ã®æ°¸ç¶šåŒ–ãƒ»å…±æœ‰ | Sheet Aï¼ˆèª­å–ï¼‰ã€Sheet Bï¼ˆæ›¸è¾¼ï¼‰ |
| **Firestore** | ã‚¢ãƒ—ãƒªè¨­å®šãƒ»å“ç‰©ç®¡ç†ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸå¯¾å¿œ |
| **Firebase Storage** | å†™çœŸã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ | ç›´æ¥URLå‚ç…§ |

---

## 2. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¦‚è¦                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   [ã‚¹ã‚¿ãƒƒãƒ•å…¥åŠ›]                                                   â”‚
â”‚        â”‚                                                           â”‚
â”‚        â–¼                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ Frontend â”‚â”€â”€â”€â”€â–¶â”‚ Cloud Func  â”‚â”€â”€â”€â”€â–¶â”‚  Sheet B    â”‚            â”‚
â”‚   â”‚ (PWA)    â”‚     â”‚ (API)       â”‚     â”‚  (æ›¸ãè¾¼ã¿) â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                          â”‚                                         â”‚
â”‚                          â–¼                                         â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                   â”‚  Firestore  â”‚     â”‚  Sheet A    â”‚            â”‚
â”‚                   â”‚  (è¨­å®šç­‰)   â”‚     â”‚  (èª­ã¿å–ã‚Š) â”‚            â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                              â”‚                     â”‚
â”‚                                              â–¼                     â”‚
â”‚                                       [å®¶æ—é–²è¦§]                   â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Google Sheets æ§‹é€ 

### 3.1 Sheet Aï¼ˆè¨˜éŒ²ã®çµæœ / èª­ã¿å–ã‚Šå°‚ç”¨ï¼‰

**è©³ç´°ä»•æ§˜**: [SHEET_A_STRUCTURE.md](./archive/SHEET_A_STRUCTURE.md)

æ–½è¨­å´ã®è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å‡ºåŠ›ã•ã‚ŒãŸã‚±ã‚¢è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã€‚å®¶æ—å‘ã‘é–²è¦§ç”¨ã€‚

#### ã‚·ãƒ¼ãƒˆä¸€è¦§

| ã‚·ãƒ¼ãƒˆå | ç”¨é€” |
|----------|------|
| é£Ÿäº‹ | é£Ÿäº‹æ‘‚å–è¨˜éŒ² |
| æ°´åˆ†æ‘‚å–é‡ | æ°´åˆ†æ‘‚å–è¨˜éŒ² |
| æ’ä¾¿ãƒ»æ’å°¿ | æ’æ³„è¨˜éŒ² |
| ãƒã‚¤ã‚¿ãƒ« | ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³è¨˜éŒ² |
| å£è…”ã‚±ã‚¢ | å£è…”ã‚±ã‚¢è¨˜éŒ² |
| å†…æœ | æœè–¬è¨˜éŒ² |
| ç‰¹è¨˜äº‹é … | ç‰¹è¨˜äº‹é …ãƒ»ãƒ¡ãƒ¢ |
| è¡€ç³–å€¤ã‚¤ãƒ³ã‚¹ãƒªãƒ³æŠ•ä¸ | è¡€ç³–å€¤ãƒ»ã‚¤ãƒ³ã‚¹ãƒªãƒ³è¨˜éŒ² |
| å¾€è¨ºéŒ² | å¾€è¨ºè¨˜éŒ² |
| ä½“é‡ | ä½“é‡æ¸¬å®šè¨˜éŒ² |
| ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹éŒ² | ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹è¨˜éŒ² |

### 3.2 Sheet Bï¼ˆå®Ÿç¸¾å…¥åŠ›å…ˆ / æ›¸ãè¾¼ã¿ç”¨ï¼‰

**è©³ç´°ä»•æ§˜**: [SHEET_B_STRUCTURE.md](./archive/SHEET_B_STRUCTURE.md)

PWAã‹ã‚‰ã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ã‚·ãƒ¼ãƒˆã€‚

#### ã‚«ãƒ©ãƒ æ§‹æˆï¼ˆãƒ•ã‚©ãƒ¼ãƒ ã®å›ç­” 1ï¼‰

| ã‚«ãƒ©ãƒ  | å†…å®¹ |
|--------|------|
| timestamp | å…¥åŠ›æ—¥æ™‚ |
| record_date | è¨˜éŒ²æ—¥ |
| meal_type | é£Ÿäº‹ç¨®åˆ¥ |
| main_dish | ä¸»é£Ÿ |
| side_dish | å‰¯é£Ÿ |
| soup | æ±ç‰© |
| snack | é–“é£Ÿ |
| water_intake | æ°´åˆ†æ‘‚å–é‡ |
| note | å‚™è€ƒ |

---

## 4. Firestore ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

| ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ | ç”¨é€” | ä¸»è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |
|--------------|------|----------------|
| `allowed_domains` | ãƒ‰ãƒ¡ã‚¤ãƒ³è¨±å¯ãƒªã‚¹ãƒˆï¼ˆPhase 52ï¼‰ | {domain}: { allowed: true } |
| `allowed_emails` | ãƒ¡ãƒ¼ãƒ«è¨±å¯ãƒªã‚¹ãƒˆï¼ˆPhase 52ï¼‰ | {email_key}: { allowed: true } |
| `settings` | ã‚¢ãƒ—ãƒªè¨­å®š | webhookUrl, driveSettings |
| `items` | å“ç‰©ãƒã‚¹ã‚¿ | name, category, isActive, remainingHandlingLogs |
| `presets` | ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆã„ã¤ã‚‚ã®æŒ‡ç¤ºï¼‰ | name, category, instruction, matchConfig |
| `prohibitions` | ç¦æ­¢ãƒ«ãƒ¼ãƒ« | itemId, reason |
| `careItems` | ã‚±ã‚¢è¨˜éŒ² | recordDate, mealType, items |
| `care_photos` | å†™çœŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆPhase 17/52ï¼‰ | photoUrl, residentId, source |
| `chat_messages` | ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | content, sender, timestamp |
| `staffNotes` | ã‚¹ã‚¿ãƒƒãƒ•æ³¨æ„äº‹é …ï¼ˆPhase 40ï¼‰ | content, priority, startDate, endDate |

---

## 5. Firebase Storage æ§‹é€ 

```
gs://facility-care-input-form.appspot.com/
â”œâ”€â”€ photos/
â”‚   â”œâ”€â”€ meal/           # é£Ÿäº‹å†™çœŸ
â”‚   â”‚   â””â”€â”€ YYYY-MM-DD/
â”‚   â”‚       â””â”€â”€ {timestamp}_{type}.jpg
â”‚   â””â”€â”€ evidence/       # ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹å†™çœŸ
â”‚       â””â”€â”€ YYYY-MM-DD/
â”‚           â””â”€â”€ {timestamp}.jpg
```

---

## 5.1 presetsã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°

ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆã„ã¤ã‚‚ã®æŒ‡ç¤ºï¼‰ã®è©³ç´°æ§‹é€ ã€‚

### æ§‹é€ 

```typescript
// Firestore: presets/{presetId}
{
  id: string;
  residentId: string;

  // åŸºæœ¬æƒ…å ±
  name: string;                              // "ã‚­ã‚¦ã‚¤ï¼ˆ8ç­‰åˆ†ãƒ»åŠæœˆåˆ‡ã‚Šï¼‰"
  icon?: string;                             // "ğŸ¥"

  // å“ç‰©ãƒ•ã‚©ãƒ¼ãƒ ã¸ã®é©ç”¨å€¤ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠæ™‚ã«ãƒ•ã‚©ãƒ¼ãƒ ã«è‡ªå‹•å…¥åŠ›ï¼‰
  itemCategory?: 'food' | 'drink';           // é£Ÿã¹ç‰©/é£²ã¿ç‰©
  storageMethod?: 'room_temp' | 'refrigerated' | 'frozen';
  servingMethod?: 'as_is' | 'cut' | 'peeled' | 'heated' | 'other';
  servingMethodDetail?: string;              // "è¼ªåˆ‡ã‚Š8ç­‰åˆ†ã«ã—ã¦æä¾›"
  noteToStaff?: string;                      // ã‚¹ã‚¿ãƒƒãƒ•ã¸ã®ç”³ã—é€ã‚Š
  remainingHandlingInstruction?: 'none' | 'discarded' | 'stored';

  // ãƒãƒƒãƒãƒ³ã‚°è¨­å®š
  matchConfig: {
    keywords: string[];                      // ["ã‚­ã‚¦ã‚¤", "kiwi"]
    categories?: ItemCategory[];
    exactMatch?: boolean;
  },

  // å‡ºæ‰€è¿½è·¡
  source: 'manual' | 'ai';

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  isActive: boolean;
  usageCount: number;
  lastUsedAt?: string;

  // ãƒ¡ã‚¿
  createdAt: string;
  updatedAt: string;
  createdBy: string;
}
```

### æ¡ä»¶ã®æ‰±ã„

ç‰¹åˆ¥ãªæ¡ä»¶ï¼ˆã€Œä½“èª¿ä¸è‰¯æ™‚ã¯é™¤å¤–ã€ãªã©ï¼‰ã¯ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã§ã¯ãªãå“ç‰©ã®`noteToStaff`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨˜è¼‰ã—ã¾ã™ã€‚

---

## 5.2 itemsã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°ï¼ˆå“ç‰©ãƒã‚¹ã‚¿ï¼‰

å“ç‰©ï¼ˆCareItemï¼‰ã®è©³ç´°æ§‹é€ ã€‚

### RemainingHandlingLogå‹

å“ç‰©ã®ç ´æ£„/ä¿å­˜å±¥æ­´ã‚’è¨˜éŒ²ã™ã‚‹å‹ã€‚

```typescript
interface RemainingHandlingLog {
  id: string;                         // ãƒ­ã‚°IDï¼ˆRHL_{timestamp}_{random}ï¼‰
  handling: 'discarded' | 'stored';   // å¯¾å¿œç¨®åˆ¥
  quantity: number;                   // å¯¾å¿œã—ãŸæ•°é‡
  note?: string;                      // ãƒ¡ãƒ¢
  recordedBy: string;                 // è¨˜éŒ²è€…
  recordedAt: string;                 // è¨˜éŒ²æ—¥æ™‚ï¼ˆISO8601ï¼‰
}
```

### ä½¿ç”¨ç®‡æ‰€

- **æ®‹ã‚Šå¯¾å¿œã‚¿ãƒ–**ï¼ˆ`/staff/input/meal`ï¼‰: ç ´æ£„æ¸ˆã¿/ä¿å­˜æ¸ˆã¿å“ç‰©ã®è¡¨ç¤º
  - ç ´æ£„æ¸ˆã¿: é–²è¦§ã®ã¿ï¼ˆè¨˜éŒ²ãƒœã‚¿ãƒ³ãªã—ï¼‰
  - ä¿å­˜æ¸ˆã¿: ã€Œæä¾›è¨˜éŒ²ã€ãƒœã‚¿ãƒ³ã§é€šå¸¸ã®è¨˜éŒ²ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã

### ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 

```typescript
// items/{itemId}
{
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...
  normalizedName?: string;                         // çµ±è¨ˆç”¨ã®æ­£è¦åŒ–åï¼ˆPhase 43ï¼‰
  remainingHandlingLogs?: RemainingHandlingLog[];  // æ®‹ã‚Šå¯¾å¿œå±¥æ­´ï¼ˆPhase 42ï¼‰

  // Phase 49: å»ƒæ£„æŒ‡ç¤ºãƒ•ãƒ­ãƒ¼
  status?: ItemStatus;                             // å“ç‰©ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  discardRequestedAt?: string;                     // å»ƒæ£„æŒ‡ç¤ºæ—¥æ™‚ï¼ˆISO8601ï¼‰
  discardRequestedBy?: string;                     // å»ƒæ£„æŒ‡ç¤ºè€…
  discardReason?: string;                          // å»ƒæ£„ç†ç”±
  discardedAt?: string;                            // å»ƒæ£„å®Œäº†æ—¥æ™‚ï¼ˆISO8601ï¼‰
  discardedBy?: string;                            // å»ƒæ£„å®Œäº†è€…
}

// ItemStatuså‹å®šç¾©
type ItemStatus =
  | 'pending'           // ç™»éŒ²æ¸ˆã¿ï¼ˆæœªæä¾›ï¼‰
  | 'in_progress'       // æä¾›ä¸­
  | 'served'            // æä¾›æ¸ˆã¿
  | 'consumed'          // æ¶ˆè²»å®Œäº†
  | 'expired'           // æœŸé™åˆ‡ã‚Œ
  | 'pending_discard'   // å»ƒæ£„æŒ‡ç¤ºä¸­ï¼ˆPhase 49ï¼‰
  | 'discarded';        // å»ƒæ£„å®Œäº†ï¼ˆPhase 49ï¼‰
```

### normalizedNameï¼ˆPhase 43: çµ±è¨ˆç”¨ã®å“ç‰©åæ­£è¦åŒ–ï¼‰

çµ±è¨ˆé›†è¨ˆæ™‚ã«å“ç‰©åã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¾ã¨ã‚ã‚‹ãŸã‚ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€‚

- **ç”¨é€”**: ã€Œæ£®æ°¸ãƒ—ãƒªãƒ³ã€ã€Œãªã‚ã‚‰ã‹ãƒ—ãƒªãƒ³ã€â†’ã€Œãƒ—ãƒªãƒ³ã€ã§é›†è¨ˆ
- **è¨­å®šæ–¹æ³•**: å“ç‰©ç™»éŒ²æ™‚ã«ã€ŒğŸ“Š çµ±è¨ˆã§ã®è¡¨ç¤ºåã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§å…¥åŠ›
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: æœªè¨­å®šæ™‚ã¯`itemName`ã‚’ä½¿ç”¨
- **çµ±è¨ˆè¨ˆç®—**: `getFoodStats`ã§`normalizedName || itemName`ã‚’é›†è¨ˆã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨

---

## 5.3 plan_data_summariesã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆPhase 46: éšå±¤çš„è¦ç´„ï¼‰

RAGå“è³ªå‘ä¸Šã®ãŸã‚ã®äº‹å‰è¦ç´„ãƒ‡ãƒ¼ã‚¿ã€‚syncPlanDataå®Ÿè¡Œæ™‚ã«è‡ªå‹•ç”Ÿæˆã€‚

### æ§‹é€ 

```typescript
// Firestore: plan_data_summaries/{summaryId}
interface PlanDataSummary {
  id: string;                    // "2025-12" (æœˆæ¬¡) / "2025-W52" (é€±æ¬¡) / "2025-12-29" (æ—¥æ¬¡)
  type: 'daily' | 'weekly' | 'monthly';

  // å¯¾è±¡ç¯„å›²
  periodStart: string;           // "2025-12-01" (ISOæ—¥ä»˜)
  periodEnd: string;             // "2025-12-31"

  // è¦ç´„å†…å®¹
  summary: string;               // AIç”Ÿæˆã®è¦ç´„ãƒ†ã‚­ã‚¹ãƒˆ
  keyInsights: string[];         // é‡è¦ãªæ´å¯Ÿï¼ˆç®‡æ¡æ›¸ãï¼‰

  // ã‚·ãƒ¼ãƒˆåˆ¥ã‚µãƒãƒªãƒ¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  sheetSummaries?: {
    sheetName: string;           // "å†…æœ", "æ’ä¾¿ãƒ»æ’å°¿" ãªã©
    summary: string;
    recordCount: number;
  }[];

  // ç›¸é–¢åˆ†æçµæœï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  correlations?: {
    pattern: string;             // "é “æœâ†’æ’ä¾¿"
    observation: string;         // "é “æœæœç”¨ç¿Œæ—¥ã«æ’ä¾¿ã‚ã‚Š: 3/3å›"
    confidence: 'high' | 'medium' | 'low';
  }[];

  // é–¢é€£æ—¥ä»˜ï¼ˆè©³ç´°æ¤œç´¢ç”¨ï¼‰
  relatedDates: string[];        // ["2024-12-13", "2024-12-17"]

  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  sourceRecordCount: number;     // è¦ç´„å…ƒã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°
  generatedAt: Timestamp;
  generatedBy: 'gemini-flash' | 'gemini-flash-lite';
}
```

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆIDè¦å‰‡

| ã‚¿ã‚¤ãƒ— | IDå½¢å¼ | ä¾‹ |
|--------|--------|-----|
| æ—¥æ¬¡ | `YYYY-MM-DD` | `2025-12-29` |
| é€±æ¬¡ | `YYYY-Www` | `2025-W52` |
| æœˆæ¬¡ | `YYYY-MM` | `2025-12` |

### ç”Ÿæˆã‚¿ã‚¤ãƒŸãƒ³ã‚°

| ã‚¿ã‚¤ãƒŸãƒ³ã‚° | ç”Ÿæˆå¯¾è±¡ | ãƒˆãƒªã‚¬ãƒ¼ |
|-----------|---------|---------|
| æ¯æ—¥åŒæœŸå¾Œ | å½“æ—¥ã®æ—¥æ¬¡ã‚µãƒãƒªãƒ¼ | syncPlanDataå®Œäº†æ™‚ |
| é€±æœ«ï¼ˆæ—¥æ›œï¼‰åŒæœŸå¾Œ | å½“é€±ã®é€±æ¬¡ã‚µãƒãƒªãƒ¼ | syncPlanData + æ›œæ—¥åˆ¤å®š |
| æœˆæœ«åŒæœŸå¾Œ | å½“æœˆã®æœˆæ¬¡ã‚µãƒãƒªãƒ¼ | syncPlanData + æ—¥ä»˜åˆ¤å®š |

### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

```
plan_data_summaries
  - type + periodStart (é™é †)    # ã‚¿ã‚¤ãƒ—åˆ¥ã®æœ€æ–°å–å¾—ç”¨
  - generatedAt (é™é †)           # å…¨ä½“ã®æœ€æ–°å–å¾—ç”¨
```

---

## 5.4 èªè¨¼è¨±å¯ãƒªã‚¹ãƒˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆPhase 52ï¼‰

èªè¨¼è¨±å¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç®¡ç†ã€‚2ã¤ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§æ§‹æˆã€‚

### allowed_domainsï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³è¨±å¯ï¼‰

```
allowed_domains/
â””â”€â”€ {domain}/              # ä¾‹: aozora-cg.com
    â””â”€â”€ { allowed: true }
```

### allowed_emailsï¼ˆå€‹åˆ¥ãƒ¡ãƒ¼ãƒ«è¨±å¯ï¼‰

```
allowed_emails/
â””â”€â”€ {email_key}/          # ä¾‹: kinuekamachi@gmail_comï¼ˆ.ã‚’_ã«ç½®æ›ï¼‰
    â””â”€â”€ { allowed: true }
```

### æ³¨æ„äº‹é …

- Firestoreã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåã«`.`ã‚’å«ã‚ã‚‰ã‚Œãªã„ãŸã‚ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®`.`ã¯`_`ã«ç½®æ›
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆAuthContextï¼‰ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ï¼ˆfirestore.rulesï¼‰ã®ä¸¡æ–¹ã§åŒä¸€ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
- ç®¡ç†ã¯CLIã¾ãŸã¯Firebase Consoleã‹ã‚‰è¡Œã†

---

## 5.5 care_photosã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆPhase 17/52/53: å†™çœŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰

ã‚±ã‚¢å†™çœŸã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã€‚

### æ§‹é€ 

```typescript
// Firestore: care_photos/{photoId}
interface CarePhoto {
  photoId: string;
  residentId: string;
  date: string;              // YYYY-MM-DD
  mealTime: string;          // breakfast/lunch/dinner/snack
  photoUrl: string;
  storagePath: string;       // direct_uploadæ™‚ã®ã¿è¨­å®š
  fileName: string;
  mimeType: string;
  fileSize: number;          // direct_uploadæ™‚ã®ã¿è¨­å®š
  staffId: string;
  staffName?: string;        // è¨˜éŒ²è€…åï¼ˆå–å¾—ã§ããªã„å ´åˆã‚ã‚Šï¼‰
  uploadedAt: string;        // ISO8601
  postId?: string;

  // Phase 52è¿½åŠ 
  source?: 'direct_upload' | 'google_chat';  // å†™çœŸã®ã‚½ãƒ¼ã‚¹

  // Phase 53è¿½åŠ ï¼ˆsource='google_chat'æ™‚ã®ã¿ï¼‰
  chatMessageId?: string;    // Chat APIã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åï¼ˆé‡è¤‡é˜²æ­¢ç”¨ï¼‰
  chatTags?: string[];       // è‡ªå‹•æŠ½å‡ºã‚¿ã‚°ï¼ˆä¾‹: ['ID7282', 'ç”»åƒ1']ï¼‰
  chatContent?: string;      // UIè¡¨ç¤ºç”¨ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæœ€å¤§500æ–‡å­—ï¼‰
}
```

### sourceãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

| å€¤ | èª¬æ˜ |
|-----|------|
| `direct_upload` | ã‚¢ãƒ—ãƒªã‹ã‚‰ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |
| `google_chat` | Google Chatã‚¹ãƒšãƒ¼ã‚¹ã‹ã‚‰å–å¾— |

å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯sourceæœªè¨­å®šï¼ˆå–å¾—æ™‚ã«`direct_upload`ã¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ã€‚

### Google ChatåŒæœŸæ™‚ã®åˆ¶é™äº‹é …

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å–å¾—å¯å¦ | å‚™è€ƒ |
|------------|----------|------|
| photoUrl | âœ… | Firebase Storage URL |
| date | âœ… | IDãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æŠ•ç¨¿æ—¥æ™‚ |
| staffName | âš ï¸ | IDãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡ã«ã€Œè¨˜éŒ²è€…ï¼šã€‡ã€‡ã€ã¨è¨˜è¼‰ãŒã‚ã‚‹å ´åˆã®ã¿ |
| storagePath | âŒ | ãƒªãƒ³ã‚¯ã®ã¿ï¼ˆç©ºæ–‡å­—ï¼‰ |
| fileSize | âŒ | ä¸æ˜ï¼ˆ0ï¼‰ |

---

## 6. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–¢é€£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Item      â”‚â”€â”€â”€â”€â–¶â”‚   Preset    â”‚â”€â”€â”€â”€â–¶â”‚  CareItem   â”‚
â”‚  (å“ç‰©)     â”‚     â”‚ (ãƒ—ãƒªã‚»ãƒƒãƒˆ)â”‚     â”‚ (ã‚±ã‚¢è¨˜éŒ²)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                       â”‚
       â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prohibition â”‚                         â”‚   Photo     â”‚
â”‚ (ç¦æ­¢ãƒ«ãƒ¼ãƒ«)â”‚                         â”‚  (å†™çœŸ)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ»ç§»è¡Œæ–¹é‡

| é …ç›® | æ–¹é‡ |
|------|------|
| ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ | å¾Œæ–¹äº’æ›æ€§ã‚’ç¶­æŒ |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | Cloud Functions ã§å®Ÿè¡Œ |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | Firestoreè‡ªå‹•ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆæœªå®Ÿè£…ï¼‰ |

---

## 8. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [SHEET_A_STRUCTURE.md](./archive/SHEET_A_STRUCTURE.md) - Sheet A è©³ç´°ä»•æ§˜
- [SHEET_B_STRUCTURE.md](./archive/SHEET_B_STRUCTURE.md) - Sheet B è©³ç´°ä»•æ§˜
- [API_SPEC.md](./API_SPEC.md) - APIä»•æ§˜

---

## æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------|----------|
| 2026-01-03 | Phase 52: allowed_users, care_photos.sourceè¿½åŠ ã€èªè¨¼ãƒ•ãƒ­ãƒ¼è¿½åŠ  |
| 2025-12-24 | Phase 42: RemainingHandlingLogå‹ãƒ»æ®‹ã‚Šå¯¾å¿œã‚¿ãƒ–ä»•æ§˜è¿½åŠ  |
| 2025-12-23 | Phase 41è¨­è¨ˆã‚’å‰Šé™¤ï¼ˆæ—¢å­˜ãƒ•ã‚©ãƒ¼ãƒ æ§‹é€ ã¨ä¸æ•´åˆã®ãŸã‚ãƒªãƒãƒ¼ãƒˆï¼‰ |
| 2025-12-23 | Phase 40: staffNotesã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ  |
| 2025-12-20 | çµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ |
