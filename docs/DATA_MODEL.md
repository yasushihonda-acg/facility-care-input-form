---
status: working
scope: data
owner: core-team
last_reviewed: 2025-12-23
links:
  - docs/archive/SHEET_A_STRUCTURE.md
  - docs/archive/SHEET_B_STRUCTURE.md
  - docs/API_SPEC.md
---

# ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

> **çµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ãƒ‡ãƒ¼ã‚¿æ§‹é€ é–¢é€£ä»•æ§˜ã‚’é›†ç´„ã—ãŸåŒ…æ‹¬çš„ãªã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

---

## 1. æ¦‚è¦

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ï¼š

| ã‚¹ãƒˆã‚¢ | ç”¨é€” | å‚™è€ƒ |
|--------|------|------|
| **Google Sheets** | ã‚±ã‚¢è¨˜éŒ²ã®æ°¸ç¶šåŒ–ãƒ»å…±æœ‰ | Sheet Aï¼ˆèª­å–ï¼‰ã€Sheet Bï¼ˆæ›¸è¾¼ï¼‰ |
| **Firestore** | ã‚¢ãƒ—ãƒªè¨­å®šãƒ»å“ç‰©ç®¡ç†ãƒ»ã‚¿ã‚¹ã‚¯ | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸå¯¾å¿œ |
| **Firebase Storage** | å†™çœŸã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ | ç›´æ¥URLå‚ç…§ |

---

## 2. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¦‚è¦                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   [ã‚¹ã‚¿ãƒƒãƒ•å…¥åŠ›]                                                   â”‚
â”‚        â”‚                                                           â”‚
â”‚        â–¼                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ Frontend â”‚â”€â”€â”€â”€â–¶â”‚ Cloud Func  â”‚â”€â”€â”€â”€â–¶â”‚  Sheet B    â”‚            â”‚
â”‚   â”‚ (PWA)    â”‚     â”‚ (API)       â”‚     â”‚  (æ›¸ãè¾¼ã¿) â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                          â”‚                                         â”‚
â”‚                          â–¼                                         â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                   â”‚  Firestore  â”‚     â”‚  Sheet A    â”‚            â”‚
â”‚                   â”‚  (è¨­å®šç­‰)   â”‚     â”‚  (èª­ã¿å–ã‚Š) â”‚            â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                              â”‚                     â”‚
â”‚                                              â–¼                     â”‚
â”‚                                       [å®¶æ—é–²è¦§]                   â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Google Sheets æ§‹é€ 

### 3.1 Sheet Aï¼ˆè¨˜éŒ²ã®çµæœ / èª­ã¿å–ã‚Šå°‚ç”¨ï¼‰

**è©³ç´°ä»•æ§˜**: [SHEET_A_STRUCTURE.md](./archive/SHEET_A_STRUCTURE.md)

æ–½è¨­å´ã®è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å‡ºåŠ›ã•ã‚ŒãŸã‚±ã‚¢è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ã€‚å®¶æ—å‘ã‘é–²è¦§ç”¨ã€‚

#### ã‚·ãƒ¼ãƒˆä¸€è¦§

| ã‚·ãƒ¼ãƒˆå | ç”¨é€” |
|----------|------|
| é£Ÿäº‹ | é£Ÿäº‹æ‘‚å–è¨˜éŒ² |
| æ°´åˆ†æ‘‚å–é‡ | æ°´åˆ†æ‘‚å–è¨˜éŒ² |
| æ’ä¾¿ãƒ»æ’å°¿ | æ’æ³„è¨˜éŒ² |
| ãƒã‚¤ã‚¿ãƒ« | ãƒã‚¤ã‚¿ãƒ«ã‚µã‚¤ãƒ³è¨˜éŒ² |
| å£è…”ã‚±ã‚¢ | å£è…”ã‚±ã‚¢è¨˜éŒ² |
| å†…æœ | æœè–¬è¨˜éŒ² |
| ç‰¹è¨˜äº‹é … | ç‰¹è¨˜äº‹é …ãƒ»ãƒ¡ãƒ¢ |
| è¡€ç³–å€¤ã‚¤ãƒ³ã‚¹ãƒªãƒ³æŠ•ä¸ | è¡€ç³–å€¤ãƒ»ã‚¤ãƒ³ã‚¹ãƒªãƒ³è¨˜éŒ² |
| å¾€è¨ºéŒ² | å¾€è¨ºè¨˜éŒ² |
| ä½“é‡ | ä½“é‡æ¸¬å®šè¨˜éŒ² |
| ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹éŒ² | ã‚«ãƒ³ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹è¨˜éŒ² |

### 3.2 Sheet Bï¼ˆå®Ÿç¸¾å…¥åŠ›å…ˆ / æ›¸ãè¾¼ã¿ç”¨ï¼‰

**è©³ç´°ä»•æ§˜**: [SHEET_B_STRUCTURE.md](./archive/SHEET_B_STRUCTURE.md)

PWAã‹ã‚‰ã®å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ã‚·ãƒ¼ãƒˆã€‚

#### ã‚«ãƒ©ãƒ æ§‹æˆï¼ˆãƒ•ã‚©ãƒ¼ãƒ ã®å›ç­” 1ï¼‰

| ã‚«ãƒ©ãƒ  | å†…å®¹ |
|--------|------|
| timestamp | å…¥åŠ›æ—¥æ™‚ |
| record_date | è¨˜éŒ²æ—¥ |
| meal_type | é£Ÿäº‹ç¨®åˆ¥ |
| main_dish | ä¸»é£Ÿ |
| side_dish | å‰¯é£Ÿ |
| soup | æ±ç‰© |
| snack | é–“é£Ÿ |
| water_intake | æ°´åˆ†æ‘‚å–é‡ |
| note | å‚™è€ƒ |

---

## 4. Firestore ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

| ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ | ç”¨é€” | ä¸»è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |
|--------------|------|----------------|
| `settings` | ã‚¢ãƒ—ãƒªè¨­å®š | webhookUrl, driveSettings |
| `items` | å“ç‰©ãƒã‚¹ã‚¿ | name, category, isActive |
| `tasks` | ã‚¿ã‚¹ã‚¯ç®¡ç† | title, status, dueDate |
| `presets` | ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆã„ã¤ã‚‚ã®æŒ‡ç¤ºï¼‰ | name, category, instruction, matchConfig |
| `prohibitions` | ç¦æ­¢ãƒ«ãƒ¼ãƒ« | itemId, reason |
| `careItems` | ã‚±ã‚¢è¨˜éŒ² | recordDate, mealType, items |
| `chat_messages` | ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | content, sender, timestamp |
| `staffNotes` | ã‚¹ã‚¿ãƒƒãƒ•æ³¨æ„äº‹é …ï¼ˆPhase 40ï¼‰ | content, priority, startDate, endDate |

---

## 5. Firebase Storage æ§‹é€ 

```
gs://facility-care-input-form.appspot.com/
â”œâ”€â”€ photos/
â”‚   â”œâ”€â”€ meal/           # é£Ÿäº‹å†™çœŸ
â”‚   â”‚   â””â”€â”€ YYYY-MM-DD/
â”‚   â”‚       â””â”€â”€ {timestamp}_{type}.jpg
â”‚   â””â”€â”€ evidence/       # ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹å†™çœŸ
â”‚       â””â”€â”€ YYYY-MM-DD/
â”‚           â””â”€â”€ {timestamp}.jpg
```

---

## 5.1 presetsã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°

ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆã„ã¤ã‚‚ã®æŒ‡ç¤ºï¼‰ã®è©³ç´°æ§‹é€ ã€‚

### ç¾è¡Œæ§‹é€ ï¼ˆPhase 37ï¼‰

```typescript
// Firestore: presets/{presetId}
{
  id: string;
  residentId: string;

  // åŸºæœ¬æƒ…å ±
  name: string;                              // "ã‚­ã‚¦ã‚¤8ç­‰åˆ†"
  category: 'cut' | 'serve' | 'condition';   // å˜ä¸€é¸æŠ â† èª²é¡Œ
  icon?: string;

  // æŒ‡ç¤ºå†…å®¹
  instruction: {
    content: string;                         // "è¼ªåˆ‡ã‚Š8ç­‰åˆ†ã«ã—ã¦æä¾›"
    servingMethod?: 'warm' | 'cold' | 'room';
    servingDetail?: string;
  },

  // ãƒãƒƒãƒãƒ³ã‚°è¨­å®š
  matchConfig: {
    keywords: string[];                      // ["ã‚­ã‚¦ã‚¤", "ãƒ•ãƒ«ãƒ¼ãƒ„"]
    categories?: ItemCategory[];
    exactMatch?: boolean;
  },

  // å‡ºæ‰€è¿½è·¡
  source: 'fax' | 'family_app' | 'ai_generated' | 'staff_created';
  aiSourceInfo?: {
    model: string;
    confidence: number;
    generatedAt: string;
  },

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  isActive: boolean;
  usageCount: number;
  lastUsedAt?: string;

  // ãƒ¡ã‚¿
  createdAt: string;
  updatedAt: string;
  createdBy: string;
}
```

### æ”¹å–„å¾Œæ§‹é€ ï¼ˆPhase 41äºˆå®šï¼‰

```typescript
// Firestore: presets/{presetId}
{
  id: string;
  residentId: string;
  name: string;
  icon?: string;

  // ã€æ”¹å–„ã€‘ã‚«ãƒ†ã‚´ãƒªåˆ¥æŒ‡ç¤º
  instructions: {
    cut?: string;        // ã‚«ãƒƒãƒˆæ–¹æ³•ã®æŒ‡ç¤ºï¼ˆä»»æ„ï¼‰
    serve?: string;      // æä¾›æ–¹æ³•ã®æŒ‡ç¤ºï¼ˆä»»æ„ï¼‰
    condition?: string;  // æ¡ä»¶ä»˜ãå¯¾å¿œã®æŒ‡ç¤ºï¼ˆä»»æ„ï¼‰
  },

  // ã€å¾Œæ–¹äº’æ›æ€§ç”¨ã€‘ç§»è¡Œå®Œäº†å¾Œã«å‰Šé™¤
  category?: 'cut' | 'serve' | 'condition';  // deprecated
  instruction?: {                             // deprecated
    content: string;
  },

  // ãƒãƒƒãƒãƒ³ã‚°è¨­å®šï¼ˆå¤‰æ›´ãªã—ï¼‰
  matchConfig: { ... },

  // ãã®ä»–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå¤‰æ›´ãªã—ï¼‰
  source: string;
  isActive: boolean;
  ...
}
```

### ã‚«ãƒ†ã‚´ãƒªå®šç¾©

| ã‚«ãƒ†ã‚´ãƒª | èª¬æ˜ | ã‚¢ã‚¤ã‚³ãƒ³ | ä¾‹ |
|----------|------|----------|-----|
| `cut` | ã‚«ãƒƒãƒˆãƒ»èª¿ç†æ–¹æ³• | âœ‚ï¸ | "è¼ªåˆ‡ã‚Š8ç­‰åˆ†", "ã™ã‚ŠãŠã‚ã—" |
| `serve` | æä¾›æ–¹æ³•ãƒ»æ¸©åº¦ | ğŸ½ï¸ | "æ¸©ã‚ã¦æä¾›", "å¸¸æ¸©ã§" |
| `condition` | æ¡ä»¶ä»˜ãå¯¾å¿œ | âš ï¸ | "æœˆæ°´é‡‘ã®ã¿ç¦æ­¢", "ä½“èª¿ä¸è‰¯æ™‚ã¯é™¤å¤–" |

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ–¹é‡

```
æ—¢å­˜ãƒ‡ãƒ¼ã‚¿: { category: 'cut', instruction: { content: '8ç­‰åˆ†' } }
    â†“ ç§»è¡Œ
æ–°ãƒ‡ãƒ¼ã‚¿:   { instructions: { cut: '8ç­‰åˆ†' }, category: 'cut', instruction: { content: '8ç­‰åˆ†' } }
    â†“ æ¤œè¨¼æœŸé–“å¾Œ
æœ€çµ‚:       { instructions: { cut: '8ç­‰åˆ†' } }
```

---

## 6. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–¢é€£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Item      â”‚â”€â”€â”€â”€â–¶â”‚   Preset    â”‚â”€â”€â”€â”€â–¶â”‚  CareItem   â”‚
â”‚  (å“ç‰©)     â”‚     â”‚ (ãƒ—ãƒªã‚»ãƒƒãƒˆ)â”‚     â”‚ (ã‚±ã‚¢è¨˜éŒ²)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                       â”‚
       â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prohibition â”‚                         â”‚   Photo     â”‚
â”‚ (ç¦æ­¢ãƒ«ãƒ¼ãƒ«)â”‚                         â”‚  (å†™çœŸ)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒ»ç§»è¡Œæ–¹é‡

| é …ç›® | æ–¹é‡ |
|------|------|
| ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ | å¾Œæ–¹äº’æ›æ€§ã‚’ç¶­æŒ |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | Cloud Functions ã§å®Ÿè¡Œ |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— | Firestoreè‡ªå‹•ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆæœªå®Ÿè£…ï¼‰ |

---

## 8. é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [SHEET_A_STRUCTURE.md](./archive/SHEET_A_STRUCTURE.md) - Sheet A è©³ç´°ä»•æ§˜
- [SHEET_B_STRUCTURE.md](./archive/SHEET_B_STRUCTURE.md) - Sheet B è©³ç´°ä»•æ§˜
- [API_SPEC.md](./API_SPEC.md) - APIä»•æ§˜

---

## æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------|----------|
| 2025-12-23 | Phase 41è¨­è¨ˆ: presetsã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ”¹å–„è¨­è¨ˆè¿½åŠ  |
| 2025-12-23 | Phase 40: staffNotesã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ  |
| 2025-12-20 | çµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ |
