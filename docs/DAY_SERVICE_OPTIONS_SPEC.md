# デイサービス選択肢機能 設計書

> **作成日**: 2025年12月15日
> **ステータス**: 完了

---

## 1. 概要

### 1.1 目的

食事入力フォームの「どこのデイサービスですか？」フィールドに、管理者が設定した固定選択肢リストを表示する。

### 1.2 現状の問題

- `defaultDayServiceName`（単一値）のみ設定可能
- 複数のデイサービス施設から選択する必要がある現場運用に対応できていない

### 1.3 要件

ユーザー提供の選択肢リスト:
1. 武
2. 田上
3. 笹貫
4. 下荒田
5. 東千石
6. 南栄
7. 永吉
8. 七福の里

**デフォルト設定**:
- `defaultDayServiceName` は空（未選択）
- 選択肢は固定リスト（管理者設定不要）

---

## 2. 設計方針

### 2.1 アプローチ: フロントエンド固定リスト

**選択理由**:
- 選択肢は固定であり、運用中に変更される可能性が低い
- API変更が不要でシンプル
- バックエンドの設定に依存せず独立して動作

**代替案（不採用）**:
- 管理者設定で選択肢を動的管理 → 運用要件に対してオーバースペック

### 2.2 変更範囲

| ファイル | 変更内容 |
|---------|----------|
| `frontend/src/types/mealForm.ts` | `DAY_SERVICE_OPTIONS` 定数追加 |
| `frontend/src/pages/MealInputPage.tsx` | 固定リストを使用するよう修正 |
| `frontend/src/components/MealSettingsModal.tsx` | デイサービス設定フィールドを削除 |

---

## 3. 技術設計

### 3.1 新規定数

**ファイル**: `frontend/src/types/mealForm.ts`

```typescript
/**
 * デイサービス選択肢（固定リスト）
 * 「選んでください」は選択肢として含めず、UI側で制御
 */
export const DAY_SERVICE_OPTIONS: string[] = [
  '武',
  '田上',
  '笹貫',
  '下荒田',
  '東千石',
  '南栄',
  '永吉',
  '七福の里',
];
```

### 3.2 MealInputPage.tsx 変更

**変更前**:
```typescript
// デイサービスリスト（初期値のみ表示）
const availableDayServices = useMemo(() => {
  if (settings.defaultDayServiceName) {
    return [settings.defaultDayServiceName];
  }
  return [];
}, [settings.defaultDayServiceName]);
```

**変更後**:
```typescript
import { DAY_SERVICE_OPTIONS } from '../types/mealForm';

// デイサービスリスト（固定リスト使用）
const availableDayServices = DAY_SERVICE_OPTIONS;
```

### 3.3 設定モーダル変更

**削除対象**: `defaultDayServiceName` 入力フィールド

理由: デイサービス選択肢は固定リストとなり、管理者設定は不要

**注意**: バックエンドの型定義は後方互換性のため変更しない

---

## 4. 実装ステップ

| # | タスク | 状態 |
|---|--------|------|
| 1 | 設計書作成 | ✅ 完了 |
| 2 | `mealForm.ts` に定数追加 | ✅ 完了 |
| 3 | `MealInputPage.tsx` 修正 | ✅ 完了 |
| 4 | `MealSettingsModal.tsx` 修正 | ✅ 完了 |
| 5 | ビルド確認 | ✅ 完了 |
| 6 | デプロイ | ✅ 完了 |
| 7 | CURRENT_STATUS.md 更新 | ✅ 完了 |

---

## 5. UI仕様

### 5.1 デイサービス選択ドロップダウン

**表示条件**: `dayServiceUsage === '利用中'` のとき表示

**選択肢**:
```
選んでください（デフォルト、value=""）
武
田上
笹貫
下荒田
東千石
南栄
永吉
七福の里
```

**バリデーション**: 「利用中」選択時、デイサービス未選択はエラー

### 5.2 設定モーダル

**削除対象**:
- 「デフォルトデイサービス」入力フィールド

**残す項目**:
- デフォルト施設
- デフォルト利用者名
- Google Chat 通知設定
- 写真アップロード設定

---

## 6. テストケース

| # | テストケース | 期待結果 |
|---|-------------|----------|
| 1 | デイサービス「利用中ではない」選択時 | デイサービス選択欄が非表示 |
| 2 | デイサービス「利用中」選択時 | デイサービス選択欄が表示され、8つの選択肢+「選んでください」が表示 |
| 3 | デイサービス「利用中」で未選択のまま送信 | バリデーションエラー |
| 4 | デイサービスを選択して送信 | 正常に送信、Sheet Bに選択値が記録 |

---

## 7. 影響範囲

### 7.1 バックエンド

変更なし（`defaultDayServiceName`フィールドは後方互換性のため残す）

### 7.2 データベース

変更なし（Firestore `settings/mealFormDefaults` の構造は維持）

### 7.3 既存データ

影響なし

---

## 8. 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-12-15 | 初版作成 |
| 2025-12-15 | 実装完了 |
