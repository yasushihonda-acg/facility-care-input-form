# E2Eテスト仕様書

> **作成日**: 2025年12月17日
> **テストツール**: Playwright
> **対象環境**: https://facility-care-input-form.web.app

---

## 1. 概要

本ドキュメントは、facility-care-input-formプロジェクトのE2Eテスト仕様を定義します。

### 1.1 テスト構成

| テストファイル | 対象 | 参照ドキュメント |
|----------------|------|------------------|
| `family-page.spec.ts` | 家族ページ | FAMILY_UX_DESIGN.md, VIEW_ARCHITECTURE_SPEC.md |
| `demo-page.spec.ts` | デモページ | DEMO_SHOWCASE_SPEC.md |

### 1.2 テスト実行方法

```bash
cd frontend

# 全テスト実行
npx playwright test

# 特定ファイルのみ
npx playwright test e2e/demo-page.spec.ts

# UIモードで実行
npx playwright test --ui

# ヘッドありで実行（ブラウザ表示）
npx playwright test --headed
```

---

## 2. デモページテスト仕様

### 2.1 テスト対象ルート

| パス | ページ | テスト内容 |
|------|--------|------------|
| `/demo` | DemoHome | デモホームが表示される、機能カードが存在する |
| `/demo/showcase` | DemoShowcase | ガイド付きツアーが表示される |
| `/demo/staff` | スタッフホーム（デモ） | スタッフビューがデモモードで表示される |
| `/demo/family` | 家族ホーム（デモ） | 家族ビューがデモモードで表示される |
| `/demo/stats` | 統計（デモ） | 統計ダッシュボードがデモデータで表示される |
| `/demo/family/items` | 品物管理（デモ） | 品物一覧がデモデータで表示される |

### 2.2 テストケース一覧

#### 2.2.1 デモホーム基本動作

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-001 | デモホームにアクセスできる | `/demo`でデモホームが表示される |
| DEMO-002 | デモモード表示がある | 「デモモード」というテキストが表示される |
| DEMO-003 | 機能カードが表示される | 品物管理、統計、タスク管理、ショーケースのカードが存在 |
| DEMO-004 | 本番へのリンクがある | 「本番へ」リンクが存在する |

#### 2.2.2 デモショーケース

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-010 | ショーケースページにアクセスできる | `/demo/showcase`でガイドが表示される |
| DEMO-011 | ステップナビゲーションがある | Step 1/6 などのステップ表示がある |
| DEMO-012 | 次へボタンで進める | 「次へ」ボタンクリックでStep 2に進む |

#### 2.2.3 デモ機能ページ

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-020 | デモスタッフホームにアクセスできる | `/demo/staff`でスタッフホームが表示される |
| DEMO-021 | デモ家族ホームにアクセスできる | `/demo/family`で家族ホームが表示される |
| DEMO-022 | デモ統計にアクセスできる | `/demo/stats`で統計ダッシュボードが表示される |
| DEMO-023 | デモ品物一覧にアクセスできる | `/demo/family/items`で品物一覧が表示される |

#### 2.2.4 デモデータ表示

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-030 | 品物一覧にサンプルデータが表示される | バナナ、キウイ等のデモ品物が表示される |
| DEMO-031 | 統計にデータが表示される | 摂食傾向・在庫サマリーにデータがある |
| DEMO-032 | タスク一覧にデモタスクが表示される | デモタスクが表示される |

#### 2.2.5 ナビゲーション

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-040 | デモホームから各機能に遷移できる | カードクリックで各デモページに遷移 |
| DEMO-041 | デモページ間を移動できる | フッターナビで移動可能 |
| DEMO-042 | デモから本番に移動できる | 「本番へ」リンクで本番ページに遷移 |

#### 2.2.6 ツアーナビゲーション（TourReturnBanner）

> **追加日**: 2025年12月17日
> **設計書**: [DEMO_SHOWCASE_SPEC.md](./DEMO_SHOWCASE_SPEC.md) セクション10

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-050 | /demo/familyでツアーバナーが表示される | 「ガイド付きツアー中」と「ツアーに戻る」が表示 |
| DEMO-051 | /demo/staffでツアーバナーが表示される | 「ガイド付きツアー中」と「ツアーに戻る」が表示 |
| DEMO-052 | /demo/statsでツアーバナーが表示される | 「ガイド付きツアー中」と「ツアーに戻る」が表示 |
| DEMO-053 | /demo/showcaseではバナー非表示 | ツアートップ自体ではバナーが表示されない |
| DEMO-054 | 「ツアーに戻る」クリックで/demo/showcaseに遷移 | ツアートップに戻れる |
| DEMO-055 | 本番ページ(/family)ではバナー非表示 | 本番ページには影響なし |

---

## 3. 検証項目

### 3.1 表示確認項目

| 項目 | 確認内容 |
|------|----------|
| レイアウト | ヘッダー・コンテンツ・フッターが正しく配置されている |
| データ表示 | シードデータが正しく表示されている |
| ナビゲーション | リンク・ボタンが正しく機能する |
| レスポンシブ | モバイル幅でも正しく表示される |

### 3.2 機能確認項目

| 項目 | 確認内容 |
|------|----------|
| ページ遷移 | 各ルートに正しく遷移できる |
| デモモード判定 | `/demo`配下ではデモモードがtrueになる |
| データ分離 | 本番APIを呼ばずにローカルデータで動作する |

---

## 4. テストデータ

### 4.1 デモシードデータ

| データ種別 | 件数 | 参照ファイル |
|------------|------|--------------|
| 品物 (CareItems) | 12件 | `frontend/src/data/demo/demoCareItems.ts` |
| 消費ログ (ConsumptionLogs) | 18件 | `frontend/src/data/demo/demoConsumptionLogs.ts` |
| タスク (Tasks) | 9件 | `frontend/src/data/demo/demoTasks.ts` |
| 統計サマリー | - | `frontend/src/data/demo/demoStats.ts` |

### 4.2 検証用サンプルデータ

テストで存在を確認するデモデータ：

| データ | 値 |
|--------|-----|
| 品物名（果物） | バナナ、キウイ、りんご |
| 品物名（おやつ） | プリン |
| カテゴリ | fruit, snack |

---

## 5. 関連ドキュメント

| ドキュメント | 内容 |
|--------------|------|
| [DEMO_SHOWCASE_SPEC.md](./DEMO_SHOWCASE_SPEC.md) | デモショーケース設計 |
| [VIEW_ARCHITECTURE_SPEC.md](./VIEW_ARCHITECTURE_SPEC.md) | ビュー構成設計 |
| [FAMILY_UX_DESIGN.md](./FAMILY_UX_DESIGN.md) | 家族向けUX設計 |

---

## 6. テスト実行結果

### 6.1 最新実行結果（2025-12-17 ツアーナビゲーション追加後）

| 結果 | 件数 | 割合 |
|------|------|------|
| ✅ 成功 | 42 | 100% |
| ❌ 失敗 | 0 | 0% |

**追加テスト**: ツアーナビゲーション（TourReturnBanner）7件

| テストID | テスト名 | 結果 |
|----------|----------|------|
| DEMO-TOUR-001 | /demo/familyでツアーバナーが表示される | ✅ |
| DEMO-TOUR-002 | /demo/staffでツアーバナーが表示される | ✅ |
| DEMO-TOUR-003 | /demo/statsでツアーバナーが表示される | ✅ |
| DEMO-TOUR-004 | /demo/showcaseではバナー非表示 | ✅ |
| DEMO-TOUR-005 | 「ツアーに戻る」クリックで/demo/showcaseに遷移 | ✅ |
| DEMO-TOUR-006 | 本番ページ(/family)ではバナー非表示 | ✅ |
| DEMO-TOUR-007 | /demo でもツアーバナーが表示される | ✅ |

### 6.2 テスト実行コマンド

```bash
cd frontend

# 全デモテスト実行
npx playwright test e2e/demo-page.spec.ts --reporter=list

# ツアーナビゲーションテストのみ
npx playwright test e2e/demo-page.spec.ts --grep "ツアーナビゲーション"

# 本番環境に対して実行（ネットワーク環境が必要）
BASE_URL=https://facility-care-input-form.web.app npx playwright test
```

### 6.3 実行時間

- 全42テスト: 約40秒
- 並列実行: 4ワーカー使用

### 6.4 過去の実行結果

| 日付 | テスト件数 | 成功 | 失敗 | 備考 |
|------|------------|------|------|------|
| 2025-12-17 | 42 | 42 | 0 | ツアーナビゲーション追加 |
| 2025-12-17 | 27 | 27 | 0 | 初回実行 |
