# E2Eテスト仕様書

> **作成日**: 2025年12月17日
> **テストツール**: Playwright
> **対象環境**: https://facility-care-input-form.web.app

---

## 1. 概要

本ドキュメントは、facility-care-input-formプロジェクトのE2Eテスト仕様を定義します。

### 1.1 テスト構成

| テストファイル | 対象 | テスト数 | 参照ドキュメント |
|----------------|------|----------|------------------|
| `demo-page.spec.ts` | デモページ基本動作 | 43件 | DEMO_SHOWCASE_SPEC.md |
| `family-user-scenario.spec.ts` | 家族ユーザーシナリオ | 34件 | DEMO_FAMILY_REDESIGN.md, FAMILY_UX_DESIGN.md |
| `family-page.spec.ts` | 家族ページ（品物詳細等） | 21件 | FAMILY_UX_DESIGN.md, VIEW_ARCHITECTURE_SPEC.md |
| `snack-record.spec.ts` | 間食記録連携 | 11件 | SNACK_RECORD_INTEGRATION_SPEC.md |

**合計: 109件**

### 1.2 テスト実行方法

```bash
cd frontend

# 全テスト実行
npx playwright test

# 特定ファイルのみ
npx playwright test e2e/demo-page.spec.ts

# UIモードで実行
npx playwright test --ui

# ヘッドありで実行（ブラウザ表示）
npx playwright test --headed
```

---

## 2. デモページテスト仕様

### 2.1 テスト対象ルート

| パス | ページ | テスト内容 |
|------|--------|------------|
| `/demo` | DemoHome | デモホームが表示される、機能カードが存在する |
| `/demo/showcase` | DemoShowcase | ガイド付きツアーが表示される |
| `/demo/staff` | スタッフホーム（デモ） | スタッフビューがデモモードで表示される |
| `/demo/family` | 家族ホーム（デモ） | 家族ビューがデモモードで表示される |
| `/demo/stats` | 統計（デモ） | 統計ダッシュボードがデモデータで表示される |
| `/demo/family/items` | 品物管理（デモ） | 品物一覧がデモデータで表示される |

### 2.2 テストケース一覧

#### 2.2.1 デモホーム基本動作

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-001 | デモホームにアクセスできる | `/demo`でデモホームが表示される |
| DEMO-002 | デモモード表示がある | 「デモモード」というテキストが表示される |
| DEMO-003 | 機能カードが表示される | 品物管理、統計、タスク管理、ショーケースのカードが存在 |
| DEMO-004 | 本番へのリンクがある | 「本番へ」リンクが存在する |

#### 2.2.2 デモショーケース

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-010 | ショーケースページにアクセスできる | `/demo/showcase`でガイドが表示される |
| DEMO-011 | ステップナビゲーションがある | Step 1/6 などのステップ表示がある |
| DEMO-012 | 次へボタンで進める | 「次へ」ボタンクリックでStep 2に進む |

#### 2.2.3 デモ機能ページ

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-020 | デモスタッフホームにアクセスできる | `/demo/staff`でスタッフホームが表示される |
| DEMO-021 | デモ家族ホームにアクセスできる | `/demo/family`で家族ホームが表示される |
| DEMO-022 | デモ統計にアクセスできる | `/demo/stats`で統計ダッシュボードが表示される |
| DEMO-023 | デモ品物一覧にアクセスできる | `/demo/family/items`で品物一覧が表示される |

#### 2.2.4 デモデータ表示

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-030 | 品物一覧にサンプルデータが表示される | バナナ、キウイ等のデモ品物が表示される |
| DEMO-031 | 統計にデータが表示される | 摂食傾向・在庫サマリーにデータがある |
| DEMO-032 | タスク一覧にデモタスクが表示される | デモタスクが表示される |

#### 2.2.5 ナビゲーション

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-040 | デモホームから各機能に遷移できる | カードクリックで各デモページに遷移 |
| DEMO-041 | デモページ間を移動できる | フッターナビで移動可能 |
| DEMO-042 | デモから本番に移動できる | 「本番へ」リンクで本番ページに遷移 |

#### 2.2.6 ツアーナビゲーション（TourReturnBanner）

> **追加日**: 2025年12月17日
> **設計書**: [DEMO_SHOWCASE_SPEC.md](./DEMO_SHOWCASE_SPEC.md) セクション10

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| DEMO-050 | /demo/familyでツアーバナーが表示される | 「ガイド付きツアー中」と「ツアーに戻る」が表示 |
| DEMO-051 | /demo/staffでツアーバナーが表示される | 「ガイド付きツアー中」と「ツアーに戻る」が表示 |
| DEMO-052 | /demo/statsでツアーバナーが表示される | 「ガイド付きツアー中」と「ツアーに戻る」が表示 |
| DEMO-053 | /demo/showcaseではバナー非表示 | ツアートップ自体ではバナーが表示されない |
| DEMO-054 | 「ツアーに戻る」クリックで/demo/showcaseに遷移 | ツアートップに戻れる |
| DEMO-055 | 本番ページ(/family)ではバナー非表示 | 本番ページには影響なし |

---

## 3. 家族ユーザーシナリオテスト仕様

> **追加日**: 2025年12月18日
> **設計書**: [DEMO_FAMILY_REDESIGN.md](./DEMO_FAMILY_REDESIGN.md), [FAMILY_UX_DESIGN.md](./FAMILY_UX_DESIGN.md)
> **テストファイル**: `frontend/e2e/family-user-scenario.spec.ts`

### 3.1 テスト目的

1. **デモツアー検証**: 家族目線でのデモツアー体験（Step 1-6）が正常に動作するか
2. **パリティ検証**: デモページと本番ページが同じUI/機能を提供するか
3. **本番準備確認**: 本番ページが家族利用に対応しているか

### 3.2 テストカテゴリ

| カテゴリ | テスト数 | 目的 |
|----------|----------|------|
| デモツアー Step 1-6 | 18件 | 家族目線でのデモ体験検証 |
| パリティテスト (PARITY) | 6件 | デモ↔本番の同一性検証 |
| ユーザーフローテスト (FLOW) | 3件 | エンドツーエンドの操作フロー検証 |
| 本番準備テスト (PROD) | 7件 | 本番ページの準備状況検証 |

### 3.3 テストケース一覧

#### 3.3.1 デモツアー Step 1-6（家族目線）

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| STEP1-01 | ダッシュボードが表示される | `/demo/family/dashboard` でダッシュボードが表示 |
| STEP1-02 | 入居者名が表示される | 「蒲池絹江」様の名前が表示 |
| STEP1-03 | タスクサマリーが表示される | 今日の予定（タスク）が表示 |
| STEP2-01 | 品物登録フォームが表示される | `/demo/family/items/new` でフォームが表示 |
| STEP2-02 | 品物名入力欄がある | itemName入力欄が存在 |
| STEP2-03 | カテゴリ選択がある | カテゴリ選択UI（果物、おやつ等）が存在 |
| STEP3-01 | 品物一覧が表示される | `/demo/family/items` で品物一覧が表示 |
| STEP3-02 | デモ品物が存在する | シードデータの品物（バナナ等）が表示 |
| STEP3-03 | 品物詳細に遷移できる | 品物クリックで詳細ページに遷移 |
| STEP4-01 | 統計ダッシュボードが表示される | `/demo/family/stats` で統計が表示 |
| STEP4-02 | 摂食傾向タブがある | 摂食傾向分析が表示可能 |
| STEP4-03 | 在庫サマリーが表示される | 在庫状況が表示 |
| STEP5-01 | リクエストページが表示される | `/demo/family/requests` でリクエスト画面が表示 |
| STEP5-02 | リクエスト入力欄がある | 要望入力フォームが存在 |
| STEP5-03 | 送信ボタンがある | リクエスト送信ボタンが存在 |
| STEP6-01 | 連絡ページが表示される | `/demo/staff/family-contact` で連絡画面が表示 |
| STEP6-02 | メッセージ一覧がある | スタッフからの連絡一覧が表示 |
| STEP6-03 | 詳細に遷移できる | メッセージクリックで詳細に遷移 |

#### 3.3.2 パリティテスト（デモ↔本番同一性）

| テストID | テスト名 | 検証内容 |
|----------|----------|----------|
| PARITY-01 | 品物登録フォーム | デモ・本番で同じフォーム要素が表示される |
| PARITY-02 | 統計ダッシュボード | デモ・本番で同じタブ構成が表示される |
| PARITY-03 | 家族リクエスト | デモ・本番で同じリクエストUIが表示される |
| PARITY-04 | ダッシュボード | デモ・本番で同じダッシュボード構造が表示される |
| PARITY-05 | 品物一覧 | デモ・本番で同じ一覧UIが表示される |
| PARITY-06 | 連絡機能 | デモ・本番で同じ連絡UIが表示される |

#### 3.3.3 ユーザーフローテスト

| テストID | テスト名 | 検証内容 |
|----------|----------|----------|
| FLOW-01 | ダッシュボードから品物登録 | ナビゲーション→フォーム入力の流れ |
| FLOW-02 | 品物一覧から詳細表示 | 一覧→詳細→戻るの流れ |
| FLOW-03 | 統計から摂食傾向確認 | 統計ページでのタブ切り替え |

#### 3.3.4 本番準備テスト

| テストID | テスト名 | 検証内容 |
|----------|----------|----------|
| PROD-01 | /family/dashboard アクセス | 本番ダッシュボードが表示される |
| PROD-02 | /family/items/new アクセス | 本番品物登録が表示される |
| PROD-03 | /family/items アクセス | 本番品物一覧が表示される |
| PROD-04 | /family/stats アクセス | 本番統計が表示される |
| PROD-05 | /family/requests アクセス | 本番リクエストが表示される |
| PROD-06 | /staff/family-contact アクセス | 本番連絡機能が表示される |
| PROD-07 | フッターナビゲーション | 家族フッターが正しく表示・機能する |

### 3.4 パリティテストの意義

```
デモで動作確認 ✅ → 本番も同様に動作する ✅
```

- **コンポーネント共有**: デモと本番は同じReactコンポーネントを使用
- **違いはデータソースのみ**: デモはローカルデータ、本番はFirestore API
- **`isDemo`フラグ**: データ取得先を切り替える唯一の違い

この設計により、**デモツアー完了 = 本番利用スキル習得** が成立。

---

## 4. 間食記録連携テスト仕様

> **追加日**: 2025年12月18日
> **設計書**: [SNACK_RECORD_INTEGRATION_SPEC.md](./SNACK_RECORD_INTEGRATION_SPEC.md)
> **テストファイル**: `frontend/e2e/snack-record.spec.ts`

### 4.1 テスト目的

スタッフの食事記録入力と家族の品物管理の連携機能が正しく動作することを検証する。

### 4.2 テストケース一覧

#### 4.2.1 品物リスト表示

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| SNACK-001 | 食事入力ページに間食セクションが表示される | 「間食について」ヘッダーが表示 |
| SNACK-002 | 在庫あり品物がリスト表示される（デモモード） | 「家族からの品物」セクションに羊羹等が表示 |
| SNACK-003 | 品物に家族指示が表示される | 「1日1切れまで」等の指示テキストが表示 |

#### 4.2.2 提供記録入力UI

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| SNACK-010 | 品物を選択すると提供記録カードが表示される | 「今回の提供記録」セクションが表示 |
| SNACK-011 | 品物選択時にサジェスト量が設定される | 提供数入力欄に1が設定される |
| SNACK-012 | 摂食状況を選択できる | 完食/半分等のボタンが機能する |
| SNACK-013 | 品物を選択解除できる | 削除ボタンで提供記録が消える |
| SNACK-014 | 家族へのメモを入力できる | メモ入力欄に入力可能 |

#### 4.2.3 サジェスト表示

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| SNACK-020 | サジェスト理由が表示される | 「指示より:」テキストが表示 |
| SNACK-021 | 在庫残量が表示される | 「残り X切れ」が表示 |

#### 4.2.4 自由テキスト入力（従来互換）

| テストID | テスト名 | 期待結果 |
|----------|----------|----------|
| SNACK-030 | 間食補足テキストを入力できる | 自由記入欄に入力可能 |

---

## 5. 検証項目

### 5.1 表示確認項目

| 項目 | 確認内容 |
|------|----------|
| レイアウト | ヘッダー・コンテンツ・フッターが正しく配置されている |
| データ表示 | シードデータが正しく表示されている |
| ナビゲーション | リンク・ボタンが正しく機能する |
| レスポンシブ | モバイル幅でも正しく表示される |

### 5.2 機能確認項目

| 項目 | 確認内容 |
|------|----------|
| ページ遷移 | 各ルートに正しく遷移できる |
| デモモード判定 | `/demo`配下ではデモモードがtrueになる |
| データ分離 | 本番APIを呼ばずにローカルデータで動作する |

---

## 6. テストデータ

### 6.1 デモシードデータ

| データ種別 | 件数 | 参照ファイル |
|------------|------|--------------|
| 品物 (CareItems) | 12件 | `frontend/src/data/demo/demoCareItems.ts` |
| 消費ログ (ConsumptionLogs) | 18件 | `frontend/src/data/demo/demoConsumptionLogs.ts` |
| タスク (Tasks) | 9件 | `frontend/src/data/demo/demoTasks.ts` |
| 統計サマリー | - | `frontend/src/data/demo/demoStats.ts` |

### 6.2 検証用サンプルデータ

テストで存在を確認するデモデータ：

| データ | 値 |
|--------|-----|
| 品物名（果物） | バナナ、キウイ、りんご |
| 品物名（おやつ） | プリン、羊羹 |
| カテゴリ | fruit, snack |

---

## 7. 関連ドキュメント

| ドキュメント | 内容 |
|--------------|------|
| [DEMO_SHOWCASE_SPEC.md](./DEMO_SHOWCASE_SPEC.md) | デモショーケース設計 |
| [VIEW_ARCHITECTURE_SPEC.md](./VIEW_ARCHITECTURE_SPEC.md) | ビュー構成設計 |
| [FAMILY_UX_DESIGN.md](./FAMILY_UX_DESIGN.md) | 家族向けUX設計 |
| [SNACK_RECORD_INTEGRATION_SPEC.md](./SNACK_RECORD_INTEGRATION_SPEC.md) | 間食記録連携設計 |

---

## 8. テスト実行結果

### 8.1 最新実行結果（2025-12-18 間食記録連携E2Eテスト追加後）

| テストファイル | 件数 | 結果 |
|----------------|------|------|
| `demo-page.spec.ts` | 43 | ✅ 全通過 |
| `family-user-scenario.spec.ts` | 34 | ✅ 全通過 |
| `family-page.spec.ts` | 21 | ⚠️ 20/21通過（1件既存失敗） |
| `snack-record.spec.ts` | 11 | ✅ 全通過 |
| **合計** | **109** | **✅ 108/109（99%）** |

### 8.2 テスト実行コマンド

```bash
cd frontend

# 全テスト実行
npx playwright test --reporter=list

# デモページテストのみ
npx playwright test e2e/demo-page.spec.ts

# 家族シナリオテストのみ
npx playwright test e2e/family-user-scenario.spec.ts

# パリティテストのみ
npx playwright test e2e/family-user-scenario.spec.ts --grep "PARITY"

# 本番環境に対して実行
BASE_URL=https://facility-care-input-form.web.app npx playwright test
```

### 8.3 実行時間

- 全109テスト: 約90秒
- 並列実行: 4ワーカー使用

### 8.4 過去の実行結果

| 日付 | テスト件数 | 成功 | 失敗 | 備考 |
|------|------------|------|------|------|
| 2025-12-18 | 109 | 108 | 1 | 間食記録連携E2Eテスト追加（11件）、family-page追加（21件） |
| 2025-12-18 | 77 | 77 | 0 | 家族ユーザーシナリオテスト追加（34件） |
| 2025-12-18 | 43 | 43 | 0 | フッター修正後 |
| 2025-12-17 | 43 | 43 | 0 | 家族向けデモ特化リデザイン |
| 2025-12-17 | 42 | 42 | 0 | ツアーナビゲーション追加 |
| 2025-12-17 | 27 | 27 | 0 | 初回実行 |
