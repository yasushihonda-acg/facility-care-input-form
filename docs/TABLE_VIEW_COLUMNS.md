---
status: working
scope: feature
owner: core-team
last_reviewed: 2025-12-20
---

# テーブルビュー表示カラム設計書

> **作成日**: 2025-12-13
> **目的**: 各シートの目的に最適化されたテーブルビュー表示を実現する

---

## 設計方針

### 基本原則

1. **一覧性の重視**: スクロールなしで重要情報を把握できる
2. **シート目的への最適化**: 各シートの記録目的に応じた主要カラムを優先表示
3. **モバイルファースト**: 3〜5カラム程度に絞り、横スクロールを最小化

### デモ版の前提

- **入居者は1名のみ**（蒲地 キヌヱ様）のため、入居者カラムは非表示
- 本番版で複数入居者対応時は入居者カラムを追加

### 表示カラム数の目安

- **モバイル**: 3〜4カラム（必須情報のみ）
- **タブレット/PC**: 4〜6カラム（詳細情報も表示）

---

## 共通カラム（全シート共通・固定位置）

| 位置 | カラム名（元ヘッダー） | 表示ラベル | 説明 |
|------|------------------------|------------|------|
| 1 | タイムスタンプ | 日時 | 記録日時（日付+時刻） |
| 末尾 | あなたの名前は？ | 担当 | 記録したスタッフ名 |

**非表示カラム（デモ版）**:
- ご利用者様のお名前は？（入居者）- 1名のみのため不要

---

## シート別表示カラム設計

### 1. 食事

**目的**: 食事摂取量の記録・確認

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | 食事はいつのことですか？ | 時間帯 | **朝/昼/夕の識別が最重要** |
| 3 | 主食の摂取量は何割ですか？ | 主食 | **摂取量の主要指標** |
| 4 | 副食の摂取量は何割ですか？ | 副食 | **摂取量の副指標** |
| 5 | あなたの名前は？ | 担当 | 共通 |

**非表示カラム**（詳細モーダルで確認）:
- ご利用者様のお名前は？（デモ版では1名のみ）
- 注入量は何ccですか？（該当者のみ）
- 間食は何を食べましたか？
- 特記事項
- 重要特記事項集計表に反映させますか？

---

### 2. 水分摂取量

**目的**: 水分摂取量の記録・1日の水分量管理

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | 水分量はいくらでしたか？ | 水分量(cc) | **最も重要な記録値** |
| 3 | あなたの名前は？ | 担当 | 共通 |

**非表示カラム**:
- ご利用者様のお名前は？（デモ版では1名のみ）
- 施設（デモ版では単一施設）
- 特記事項
- 重要特記事項集計表に反映させますか？
- デイ利用有無
- 投稿ID
- どこのデイサービスですか？

---

### 3. 排便・排尿

**目的**: 排泄状況の記録・健康管理

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | 排便はありましたか？ | 排便 | **排便有無が重要** |
| 3 | 排尿はありましたか？ | 排尿 | **排尿有無が重要** |
| 4 | 排尿量は何ccでしたか？ | 排尿量(cc) | 排尿量の記録 |
| 5 | あなたの名前は？ | 担当 | 共通 |

**非表示カラム**:
- ご利用者様のお名前は？（デモ版では1名のみ）
- 特記事項
- 重要特記事項集計表に反映させますか？
- 施設
- デイ利用有無

---

### 4. バイタル

**目的**: バイタルサイン（体温、血圧、脈拍、SpO2）の記録・異常値の早期発見

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | 体温（KT）はいくつでしたか？ | 体温 | **発熱の確認** |
| 3 | 最高血圧（BP）はいくつでしたか？ | 血圧(高) | **血圧管理** |
| 4 | 最低血圧（BP）はいくつでしたか？ | 血圧(低) | **血圧管理** |
| 5 | 脈拍（P）はいくつでしたか？ | 脈拍 | **心拍の確認** |
| 6 | 酸素飽和度（SpO2）はいくつですか？ | SpO2 | **呼吸状態の確認** |

**非表示カラム**:
- ご利用者様のお名前は？（デモ版では1名のみ）
- あなたの名前は？（担当）- バイタル値を優先
- 特記事項
- 重要特記事項集計表に反映させますか？

---

### 5. 口腔ケア

**目的**: 口腔ケア実施の記録

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | 口腔ケアはいつのことですか？ | 時間帯 | **朝/昼/夕の識別** |
| 3 | あなたの名前は？ | 担当 | 共通 |

**非表示カラム**:
- ご利用者様のお名前は？（デモ版では1名のみ）
- 施設（デモ版では単一施設）
- 特記事項
- 重要特記事項集計表に反映させますか？
- デイ利用有無
- 投稿ID
- どこのデイサービスですか？

---

### 6. 内服

**目的**: 服薬状況の記録・服薬管理

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | 内服はいつのことですか？ | タイミング | **朝食後/昼食後/夕食後の識別** |
| 3 | 何時に頓服薬を飲まれましたか？ | 頓服時刻 | 頓服の記録 |
| 4 | あなたの名前は？ | 担当 | 共通 |

**非表示カラム**:
- ご利用者様のお名前は？（デモ版では1名のみ）
- 特記事項
- 重要特記事項集計表に反映させますか？
- 施設
- デイ利用有無
- 投稿ID

---

### 7. 特記事項

**目的**: 重要な出来事・申し送り事項の記録

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | 重要特記事項集計表に反映させますか？ | 重要度 | **重要度の識別** |
| 3 | 特記事項 | 内容（先頭50文字） | **記録内容のプレビュー** |
| 4 | あなたの名前は？ | 担当 | 共通 |

**表示形式の工夫**:
- 「特記事項」カラムは先頭50文字 + "..." で省略表示
- 「重要度」は「重要」の場合に赤バッジ表示

**非表示カラム**:
- ご利用者様のお名前は？（デモ版では1名のみ）
- 写真投稿はありますか？
- 施設
- デイ利用有無
- 医療的な指示の変更ですか？
- 投稿ID

---

### 8. 血糖値インスリン投与

**目的**: 血糖値測定・インスリン投与の記録（糖尿病管理）

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | 測定時間は？ | 測定時間 | **測定タイミング** |
| 3 | 血糖値は？ | 血糖値 | **最重要の測定値** |
| 4 | インスリン投与時間は？ | 投与時間 | 投与タイミング |
| 5 | インスリン投与単位は？ | 投与量 | 投与量 |

**非表示カラム**:
- ご利用者様のお名前は？（デモ版では1名のみ）
- あなたの名前は？（担当）
- お住まいの施設は？
- 特記事項
- 重要特記事項集計表に反映させますか？

---

### 9. 往診録

**目的**: 医師往診の記録・指示内容の共有

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | Drは誰ですか？ | 担当医 | **往診医の識別** |
| 3 | 次回往診日はいつですか？ | 次回往診 | **次回予定の確認** |
| 4 | 看護業務の変更・追加がありますか？ | 指示変更 | **対応要否の確認** |

**表示形式の工夫**:
- 「指示変更」は「変更・追加あり」の場合に黄色バッジ表示

**非表示カラム**:
- ご利用者様のお名前は？（デモ版では1名のみ）
- あなたの名前は？
- 施設
- 自社からDrへの報告内容は？（長文）
- Drの往診はどのような内容でしたか？（長文）
- 重要特記事項集計表に反映させますか？

---

### 10. 体重

**目的**: 体重測定の記録・体重変動の管理

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | 何キロでしたか？ | 体重(kg) | **最重要の測定値** |
| 3 | あなたの名前は？ | 担当 | 共通 |

**非表示カラム**:
- ご利用者様のお名前は？（デモ版では1名のみ）
- 施設（デモ版では単一施設）
- 特記事項
- 重要特記事項集計表に反映させますか？
- デイ利用有無
- 投稿ID
- どこのデイサービスですか？

---

### 11. カンファレンス録

**目的**: カンファレンス内容・決定事項の記録

| 順序 | 元ヘッダー | 表示ラベル | 理由 |
|------|-----------|------------|------|
| 1 | タイムスタンプ | 日時 | 共通 |
| 2 | カンファレンス録 | 内容（先頭50文字） | **議事内容のプレビュー** |
| 3 | 自社で対応すべき事項は何ですか？ | 対応事項（先頭30文字） | **アクションアイテム** |
| 4 | 重要特記事項集計表に反映させますか？ | 重要度 | 重要度識別 |

**非表示カラム**:
- ご利用者様のお名前は？（デモ版では1名のみ）
- あなたの名前は？
- 施設
- 投稿ID
- 入退去、入退院に関する内容ですか？
- 保険適用サービスの変更はありますか？

---

## レイアウト仕様

### カラム幅の設計

テーブルのカラム幅は内容に応じて最適化する。`min-w-max`を使わず、適切な固定幅を設定する。

| カラム種別 | 幅の目安 | 理由 |
|-----------|---------|------|
| 日時 | 140px | "2025/12/13 9:28:18" が収まる最小幅 |
| 時間帯/タイミング | 80px | "朝食後" など短いテキスト |
| 数値（割/cc/kg等） | 80px | 数値は短い |
| 担当/担当医 | 100px | 人名は短め |
| 内容プレビュー | flex-1 | 残りの幅を使用 |
| バッジ付きカラム | 120px | バッジ表示分の余裕 |

### ソート機能

全カラムでソートをサポート。ヘッダークリックでソート切り替え。

**デフォルトソート**: タイムスタンプ降順（新しい順）

**ソートアルゴリズム**:
- 日時: `Date`オブジェクトに変換して比較（日付＋時刻の完全な順序を保証）
- 数値: 数値比較（空文字は0扱い）
- 文字列: `localeCompare('ja')` による日本語対応比較

> **Phase 23 変更点** (2025-12-21):
> - 日時ソートを文字列比較からDate変換比較に変更
> - 理由: `toLocaleString`が0埋めを保証しないため、`9:00` vs `18:00` で順序が崩れる問題を修正
> - 影響: 同じ日の中でも正確な時刻順でソートされるようになる

---

## 実装仕様

### データ構造

```typescript
// シート別表示カラム設定
interface SheetColumnConfig {
  sheetName: string;
  columns: ColumnDef[];
}

interface ColumnDef {
  originalHeader: string;  // 元のヘッダー名（データキー）
  displayLabel: string;    // 表示用ラベル
  width?: string;          // カラム幅（例: "140px", "80px", "flex-1"）
  truncate?: number;       // 文字数制限（超過時は"..."で省略）
  badge?: BadgeConfig;     // バッジ表示設定
  sortable?: boolean;      // ソート可能か（デフォルト: true）
  sortType?: 'string' | 'number' | 'date';  // ソート種別
}

interface BadgeConfig {
  condition: string;       // 表示条件（値との一致）
  color: string;           // バッジ色（red, yellow, green等）
}
```

### 設定ファイル配置

```
frontend/src/config/
  └── tableColumns.ts      # シート別表示カラム設定
```

---

## カラムリサイズ機能

> **Phase 24 追加** (2025-12-21)

### 概要

ユーザーがカラムヘッダーの境界をドラッグしてカラム幅を調整できる機能。

### 仕様

| 項目 | 値 |
|------|-----|
| 操作方法 | カラムヘッダー右端をドラッグ |
| 最小幅 | 各カラムの `minWidth` 設定値（デフォルト: 50px） |
| 最大幅 | 制限なし |
| リセット | ダブルクリックでデフォルト幅に戻る |
| 永続化 | セッション内のみ（ページリロードでリセット） |

### UI/UX

- **リサイズハンドル**: カラムヘッダー右端に縦線（hover時に青色表示）
- **カーソル**: リサイズ可能領域で `col-resize` カーソル
- **視覚フィードバック**: ドラッグ中はカラム幅がリアルタイムで変化
- **ダブルクリック**: デフォルト幅にリセット

### データ構造拡張

```typescript
interface ColumnDef {
  // ... 既存フィールド
  minWidth?: string;  // 最小幅（例: "50px"）- Phase 24追加
}
```

### デフォルト幅の調整

| カラム種別 | 旧デフォルト幅 | 新デフォルト幅 | 最小幅 |
|-----------|---------------|---------------|--------|
| 日時 | 140px | 165px | 100px |
| 時間帯/タイミング | 80px | 80px | 60px |
| 数値（割/cc/kg等） | 80px | 80px | 60px |
| 担当/担当医 | 100px | 100px | 60px |
| 内容プレビュー | flex-1 | flex-1 | 100px |
| バッジ付きカラム | 120px | 120px | 80px |

> **変更理由**: 日時 `2025/12/20 19:07:36` を切れずに表示するには約165px必要（14pxフォント + パディング）

---

## 今後の拡張

1. **ユーザーカスタマイズ**: 表示カラムをユーザーが選択可能に
2. **レスポンシブ対応**: 画面幅に応じて表示カラム数を自動調整
3. ~~**カラムリサイズ**: ドラッグでカラム幅を変更可能に~~ → Phase 24で実装済み
4. **カラム幅永続化**: localStorage にユーザー設定を保存
