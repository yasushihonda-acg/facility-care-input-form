<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - æ–½è¨­ã‚±ã‚¢å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        .mermaid {
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white py-8">
        <div class="container mx-auto px-4">
            <nav class="mb-4">
                <a href="index.html" class="text-indigo-200 hover:text-white transition">
                    â† ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹
                </a>
            </nav>
            <h1 class="text-3xl font-bold">ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</h1>
            <p class="text-indigo-200 mt-2">æ–½è¨­ã‚±ã‚¢å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  - æŠ€è¡“è¨­è¨ˆè©³ç´°</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-12">
        <!-- System Overview -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-500 pb-2">ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³</h2>
            <div class="bg-white rounded-lg shadow-md p-6 overflow-x-auto">
                <div class="mermaid">
flowchart TB
    subgraph Users["ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤"]
        Staff["ğŸ‘¨â€âš•ï¸ ã‚¹ã‚¿ãƒƒãƒ•"]
        Family["ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ã”å®¶æ—"]
        Admin["âš™ï¸ ç®¡ç†è€…"]
    end

    subgraph Frontend["ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆFirebase Hostingï¼‰"]
        PWA["ğŸ“± React PWA<br/>Vite + TypeScript + TailwindCSS"]
    end

    subgraph Backend["ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆCloud Functionsï¼‰"]
        direction TB
        API["ğŸ”Œ REST API"]
        Sync["â° å®šæœŸåŒæœŸ<br/>Cloud Scheduler"]
    end

    subgraph Storage["ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸"]
        Firestore["ğŸ”¥ Firestore<br/>plan_data/ settings/"]
        FBStorage["ğŸ“ Firebase Storage<br/>ç”»åƒä¿å­˜"]
    end

    subgraph External["å¤–éƒ¨é€£æº"]
        Sheets["ğŸ“Š Google Sheets<br/>Sheet A / Sheet B"]
        Chat["ğŸ’¬ Google Chat<br/>Webhooké€šçŸ¥"]
    end

    Staff --> PWA
    Family --> PWA
    Admin --> PWA

    PWA <--> API
    API <--> Firestore
    API --> FBStorage
    API --> Chat
    API <--> Sheets

    Sync --> API
                </div>
            </div>
        </section>

        <!-- Data Flow - Flow A -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-500 pb-2">Flow A: ãƒ‡ãƒ¼ã‚¿åŒæœŸï¼ˆèª­ã¿å–ã‚Šï¼‰</h2>
            <p class="text-gray-600 mb-4">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰Firestoreã¸ã®1æ™‚é–“æ¯ã®è‡ªå‹•åŒæœŸãƒ•ãƒ­ãƒ¼</p>
            <div class="bg-white rounded-lg shadow-md p-6 overflow-x-auto">
                <div class="mermaid">
sequenceDiagram
    participant Scheduler as Cloud Scheduler
    participant Func as syncPlanData
    participant Sheets as Sheet A
    participant FS as Firestore

    Scheduler->>Func: 1æ™‚é–“æ¯ã«ãƒˆãƒªã‚¬ãƒ¼
    Func->>Sheets: ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿å–å¾—
    Sheets-->>Func: å…¨ã‚·ãƒ¼ãƒˆã®è¡Œãƒ‡ãƒ¼ã‚¿

    loop å„ã‚·ãƒ¼ãƒˆ
        Func->>Func: ãƒ‡ãƒ¼ã‚¿å¤‰æ›ï¼ˆæ±ç”¨ãƒ¢ãƒ‡ãƒ«åŒ–ï¼‰
        Func->>FS: Upsert plan_data/{sheetName}/{id}
    end

    Func-->>Scheduler: åŒæœŸå®Œäº†
                </div>
            </div>
            <div class="mt-4 bg-blue-50 rounded-lg p-4">
                <h3 class="font-semibold text-blue-800 mb-2">ãƒã‚¤ãƒ³ãƒˆ</h3>
                <ul class="text-sm text-blue-700 list-disc list-inside space-y-1">
                    <li>Cloud Schedulerã§1æ™‚é–“æ¯ã«è‡ªå‹•å®Ÿè¡Œ</li>
                    <li>æ±ºå®šè«–çš„IDã§é‡è¤‡é˜²æ­¢ï¼ˆåŒæœŸç«¶åˆå¯¾ç­–ï¼‰</li>
                    <li>æ±ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã§å…¨ã‚·ãƒ¼ãƒˆã«å¯¾å¿œ</li>
                </ul>
            </div>
        </section>

        <!-- Data Flow - Flow B -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-500 pb-2">Flow B: é£Ÿäº‹è¨˜éŒ²å…¥åŠ›</h2>
            <p class="text-gray-600 mb-4">ã‚¹ã‚¿ãƒƒãƒ•ã®é£Ÿäº‹è¨˜éŒ²å…¥åŠ›ã‹ã‚‰ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ›¸ãè¾¼ã¿ãƒ»é€šçŸ¥ã¾ã§ã®ãƒ•ãƒ­ãƒ¼</p>
            <div class="bg-white rounded-lg shadow-md p-6 overflow-x-auto">
                <div class="mermaid">
sequenceDiagram
    participant Staff as ã‚¹ã‚¿ãƒƒãƒ•
    participant PWA as React PWA
    participant API as submitMealRecord
    participant FS as Firestore
    participant Sheets as Sheet B
    participant Chat as Google Chat
    participant Storage as Firebase Storage

    Staff->>PWA: é£Ÿäº‹è¨˜éŒ²å…¥åŠ›

    opt å†™çœŸã‚ã‚Š
        PWA->>API: uploadCareImage
        API->>Storage: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        Storage-->>API: photoUrl
        API->>FS: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜ (care_photos)
        API-->>PWA: ç”»åƒURL
    end

    PWA->>API: submitMealRecord
    API->>FS: è¨­å®šå–å¾—ï¼ˆWebhook URLç­‰ï¼‰
    API->>Sheets: è¡Œè¿½åŠ 
    Sheets-->>API: è¡Œç•ªå·

    API->>Chat: é€šå¸¸Webhooké€ä¿¡

    opt é‡è¦ãƒ•ãƒ©ã‚°ã‚ã‚Š
        API->>Chat: é‡è¦Webhooké€ä¿¡
    end

    API-->>PWA: æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    PWA-->>Staff: å®Œäº†è¡¨ç¤º
                </div>
            </div>
            <div class="mt-4 bg-green-50 rounded-lg p-4">
                <h3 class="font-semibold text-green-800 mb-2">ãƒã‚¤ãƒ³ãƒˆ</h3>
                <ul class="text-sm text-green-700 list-disc list-inside space-y-1">
                    <li>Sheet Bã¸ã®ç›´æ¥æ›¸ãè¾¼ã¿ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ ï¼‰</li>
                    <li>Google Chat Webhookã§è‡ªå‹•é€šçŸ¥</li>
                    <li>é‡è¦ãƒ•ãƒ©ã‚°ã§åˆ¥ãƒãƒ£ãƒ³ãƒãƒ«ã«ã‚‚è¿½åŠ é€šçŸ¥</li>
                </ul>
            </div>
        </section>

        <!-- Data Flow - Flow C -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-500 pb-2">Flow C: å®¶æ—ãƒ“ãƒ¥ãƒ¼ï¼ˆäºˆå®Ÿç®¡ç†ï¼‰</h2>
            <p class="text-gray-600 mb-4">ã”å®¶æ—ãŒã‚±ã‚¢æŒ‡ç¤ºï¼ˆPlanï¼‰ã¨å®Ÿç¸¾ï¼ˆResultï¼‰ã‚’å¯¾æ¯”ç¢ºèªã™ã‚‹ãƒ•ãƒ­ãƒ¼</p>
            <div class="bg-white rounded-lg shadow-md p-6 overflow-x-auto">
                <div class="mermaid">
sequenceDiagram
    participant Family as ã”å®¶æ—
    participant PWA as React PWA
    participant Hook as useFamilyMealRecords
    participant API as getPlanData
    participant FS as Firestore

    Family->>PWA: å®¶æ—ãƒ“ãƒ¥ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹
    PWA->>Hook: æ—¥ä»˜ãƒ»é£Ÿäº‹æ™‚é–“æŒ‡å®š
    Hook->>API: getPlanData('é£Ÿäº‹')
    API->>FS: plan_data/é£Ÿäº‹ å–å¾—
    FS-->>API: å…¨è¨˜éŒ²
    API-->>Hook: ãƒ¬ã‚¹ãƒãƒ³ã‚¹

    Hook->>Hook: æ—¥ä»˜+é£Ÿäº‹æ™‚é–“ã§ãƒ•ã‚£ãƒ«ã‚¿
    Hook->>Hook: PlanDataRecord â†’ MealResultå¤‰æ›
    Hook-->>PWA: ãƒ•ã‚£ãƒ«ã‚¿æ¸ˆã¿Result

    PWA->>PWA: Planï¼ˆãƒ¢ãƒƒã‚¯ï¼‰+ Result ã‚’çµ±åˆ
    PWA-->>Family: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º
                </div>
            </div>
            <div class="mt-4 bg-purple-50 rounded-lg p-4">
                <h3 class="font-semibold text-purple-800 mb-2">ãƒã‚¤ãƒ³ãƒˆ</h3>
                <ul class="text-sm text-purple-700 list-disc list-inside space-y-1">
                    <li>ã€Œèª­ã¿å–ã‚Šæ™‚JOINã€æ–¹å¼ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä¿®æ­£ã‚¼ãƒ­</li>
                    <li>æ—¢å­˜ã®getPlanData APIã‚’å†åˆ©ç”¨</li>
                    <li>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ»å¤‰æ›å‡¦ç†</li>
                </ul>
            </div>
        </section>

        <!-- Component Architecture -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-500 pb-2">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ§‹æˆ</h2>
            <div class="bg-white rounded-lg shadow-md p-6 overflow-x-auto">
                <div class="mermaid">
graph TB
    subgraph Pages["ãƒšãƒ¼ã‚¸"]
        Home["HomePage<br/>è¨˜éŒ²é–²è¦§"]
        Meal["MealInputPage<br/>é£Ÿäº‹å…¥åŠ›"]
        FamDash["FamilyDashboard<br/>å®¶æ—ãƒ›ãƒ¼ãƒ "]
        Evidence["EvidenceMonitor<br/>ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹"]
        Items["ItemManagement<br/>å“ç‰©ç®¡ç†"]
    end

    subgraph Components["å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ"]
        Layout["Layout"]
        Footer["FooterNav"]
        Modal["MealSettingsModal"]
        Timeline["TimelineItem"]
    end

    subgraph Hooks["ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯"]
        UsePlan["usePlanData"]
        UseSettings["useMealFormSettings"]
        UseMeal["useFamilyMealRecords"]
    end

    subgraph Services["ã‚µãƒ¼ãƒ“ã‚¹"]
        API["apiService"]
        AdminTest["adminTestService"]
    end

    Home --> UsePlan
    Meal --> UseSettings
    FamDash --> UseMeal
    Evidence --> UseMeal

    UsePlan --> API
    UseSettings --> API
    UseMeal --> UsePlan

    Pages --> Components
                </div>
            </div>
        </section>

        <!-- API Endpoints -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-500 pb-2">APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</h2>
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <table class="w-full text-sm">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-3 text-left">ãƒ¡ã‚½ãƒƒãƒ‰</th>
                            <th class="px-4 py-3 text-left">ãƒ‘ã‚¹</th>
                            <th class="px-4 py-3 text-left">èª¬æ˜</th>
                            <th class="px-4 py-3 text-left">çŠ¶æ…‹</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y">
                        <tr>
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/healthCheck</td>
                            <td class="px-4 py-3">ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/syncPlanData</td>
                            <td class="px-4 py-3">è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿åŒæœŸ</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getPlanData</td>
                            <td class="px-4 py-3">åŒæœŸæ¸ˆã¿è¨˜éŒ²å–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/submitMealRecord</td>
                            <td class="px-4 py-3">é£Ÿäº‹è¨˜éŒ²å…¥åŠ›</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getMealFormSettings</td>
                            <td class="px-4 py-3">è¨­å®šå–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/updateMealFormSettings</td>
                            <td class="px-4 py-3">è¨­å®šæ›´æ–°</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/uploadCareImage</td>
                            <td class="px-4 py-3">ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/testWebhook</td>
                            <td class="px-4 py-3">Webhookãƒ†ã‚¹ãƒˆ</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getCarePhotos</td>
                            <td class="px-4 py-3">å†™çœŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <!-- Phase 8: å“ç‰©ç®¡ç† -->
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/createCareItem</td>
                            <td class="px-4 py-3">å“ç‰©ç™»éŒ²</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getCareItems</td>
                            <td class="px-4 py-3">å“ç‰©ä¸€è¦§å–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">PUT</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/updateCareItem</td>
                            <td class="px-4 py-3">å“ç‰©æ›´æ–°</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs">DELETE</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/deleteCareItem</td>
                            <td class="px-4 py-3">å“ç‰©å‰Šé™¤</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <!-- Phase 8: ã‚¿ã‚¹ã‚¯ç®¡ç† -->
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/createTask</td>
                            <td class="px-4 py-3">ã‚¿ã‚¹ã‚¯ä½œæˆ</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getTasks</td>
                            <td class="px-4 py-3">ã‚¿ã‚¹ã‚¯ä¸€è¦§å–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">PUT</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/updateTask</td>
                            <td class="px-4 py-3">ã‚¿ã‚¹ã‚¯æ›´æ–°ãƒ»å®Œäº†</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <!-- Phase 8: çµ±è¨ˆãƒ»AI -->
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getStats</td>
                            <td class="px-4 py-3">çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/aiSuggest</td>
                            <td class="px-4 py-3">AIå“ç‰©å…¥åŠ›è£œåŠ©ï¼ˆGeminiï¼‰</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <!-- Phase 8: ãƒ—ãƒªã‚»ãƒƒãƒˆ -->
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getPresets</td>
                            <td class="px-4 py-3">ãƒ—ãƒªã‚»ãƒƒãƒˆä¸€è¦§å–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/createPreset</td>
                            <td class="px-4 py-3">ãƒ—ãƒªã‚»ãƒƒãƒˆä½œæˆ</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/saveAISuggestionAsPreset</td>
                            <td class="px-4 py-3">AIææ¡ˆã‚’ãƒ—ãƒªã‚»ãƒƒãƒˆä¿å­˜</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <!-- Phase 9: ç¦æ­¢ãƒ«ãƒ¼ãƒ« -->
                        <tr class="bg-indigo-50">
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getProhibitions</td>
                            <td class="px-4 py-3">ç¦æ­¢ãƒ«ãƒ¼ãƒ«ä¸€è¦§å–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-indigo-50">
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/createProhibition</td>
                            <td class="px-4 py-3">ç¦æ­¢ãƒ«ãƒ¼ãƒ«ä½œæˆ</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <!-- Phase 9: æ¶ˆè²»è¨˜éŒ² -->
                        <tr class="bg-indigo-50">
                            <td class="px-4 py-3"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">POST</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/recordConsumptionLog</td>
                            <td class="px-4 py-3">æ¶ˆè²»ãƒ­ã‚°è¨˜éŒ²</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-indigo-50">
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getConsumptionLogs</td>
                            <td class="px-4 py-3">æ¶ˆè²»ãƒ­ã‚°ä¸€è¦§å–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <!-- Phase 9.3: çµ±è¨ˆæ‹¡å¼µ -->
                        <tr class="bg-indigo-50">
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getInventorySummary</td>
                            <td class="px-4 py-3">åœ¨åº«ã‚µãƒãƒªãƒ¼å–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <tr class="bg-indigo-50">
                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">GET</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/getFoodStats</td>
                            <td class="px-4 py-3">é£Ÿå“å‚¾å‘åˆ†æå–å¾—</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                        <!-- Scheduler -->
                        <tr class="bg-gray-50">
                            <td class="px-4 py-3"><span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs">SCHED</span></td>
                            <td class="px-4 py-3 font-mono text-xs">/generateDailyTasks</td>
                            <td class="px-4 py-3">ã‚¿ã‚¹ã‚¯è‡ªå‹•ç”Ÿæˆï¼ˆæ¯æ—¥6æ™‚ï¼‰</td>
                            <td class="px-4 py-3"><span class="text-green-600">âœ…</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Flow D: Discard Instruction -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-500 pb-2">Flow D: å»ƒæ£„æŒ‡ç¤ºãƒ•ãƒ­ãƒ¼</h2>
            <p class="text-gray-600 mb-4">å®¶æ—ãŒæœŸé™åˆ‡ã‚Œå“ç‰©ã®å»ƒæ£„ã‚’ã‚¹ã‚¿ãƒƒãƒ•ã«ä¾é ¼ã™ã‚‹ãƒ•ãƒ­ãƒ¼ï¼ˆPhase 49ï¼‰</p>
            <div class="bg-white rounded-lg shadow-md p-6 overflow-x-auto">
                <div class="mermaid">
sequenceDiagram
    participant F as å®¶æ—
    participant App as ã‚¢ãƒ—ãƒª
    participant FS as Firestore
    participant S as ã‚¹ã‚¿ãƒƒãƒ•

    F->>App: å»ƒæ£„ãƒœã‚¿ãƒ³æŠ¼ä¸‹
    App->>FS: status: pending_discard
    App-->>F: ã€Œã‚¹ã‚¿ãƒƒãƒ•ã«é€šçŸ¥ä¸­...ã€è¡¨ç¤º

    Note over S: æ³¨æ„äº‹é …ãƒšãƒ¼ã‚¸ã‚’é–‹ã
    S->>App: å®¶æ—ä¾é ¼ã‚¿ãƒ–ã‚’ç¢ºèª
    App->>FS: pending_discardå“ç‰©å–å¾—
    FS-->>App: å»ƒæ£„æŒ‡ç¤ºãƒªã‚¹ãƒˆ
    App-->>S: èµ¤ã„å»ƒæ£„æŒ‡ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º

    S->>App: å»ƒæ£„å®Œäº†ãƒœã‚¿ãƒ³æŠ¼ä¸‹
    App->>FS: status: discarded
    App-->>F: å“ç‰©ãŒä¸€è¦§ã‹ã‚‰æ¶ˆãˆã‚‹
                </div>
            </div>
            <div class="mt-4 bg-red-50 rounded-lg p-4">
                <h3 class="font-semibold text-red-800 mb-2">ãƒã‚¤ãƒ³ãƒˆ</h3>
                <ul class="text-sm text-red-700 list-disc list-inside space-y-1">
                    <li>å®¶æ—ã¯ã€Œå»ƒæ£„ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€Œã‚¹ã‚¿ãƒƒãƒ•ã«é€šçŸ¥ä¸­...ã€è¡¨ç¤ºã«å¤‰ã‚ã‚‹</li>
                    <li>ã‚¹ã‚¿ãƒƒãƒ•ã®æ³¨æ„äº‹é …ãƒšãƒ¼ã‚¸ã«å»ƒæ£„æŒ‡ç¤ºãŒãƒãƒƒã‚¸ä»˜ãã§è¡¨ç¤ºã•ã‚Œã‚‹</li>
                    <li>å»ƒæ£„æŒ‡ç¤ºãŒã‚ã‚‹å ´åˆã€å®¶æ—ä¾é ¼ã‚¿ãƒ–ãŒè‡ªå‹•é¸æŠã•ã‚Œã‚‹</li>
                    <li>ã‚¹ã‚¿ãƒƒãƒ•ãŒã€Œå»ƒæ£„å®Œäº†ã€ã‚’æŠ¼ã™ã¨å³åº§ã«å®¶æ—å´ã‹ã‚‰æ¶ˆãˆã‚‹</li>
                </ul>
            </div>
        </section>

        <!-- Infrastructure -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b-2 border-indigo-500 pb-2">ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ</h2>
            <div class="bg-white rounded-lg shadow-md p-6 overflow-x-auto">
                <div class="mermaid">
graph LR
    subgraph GCP["Google Cloud Platform"]
        subgraph Firebase["Firebase"]
            Hosting["Firebase Hosting<br/>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰"]
            Functions["Cloud Functions<br/>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API"]
            Firestore["Firestore<br/>ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢"]
        end

        Scheduler["Cloud Scheduler<br/>1æ™‚é–“æ¯åŒæœŸ"]
        SA["Service Account<br/>facility-care-sa"]
    end

    subgraph Google["Google Workspace"]
        Sheets["Google Sheets"]
        Chat["Google Chat"]
    end

    subgraph Firebase["Firebase"]
        FBStorage["Firebase Storage"]
    end

    subgraph CI["CI/CD"]
        Actions["GitHub Actions"]
    end

    Scheduler --> Functions
    Functions --> Firestore
    Functions --> Sheets
    Functions --> FBStorage
    Functions --> Chat
    SA -.-> Functions
    Actions --> Hosting
    Actions --> Functions
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400">
                Â© 2025 æ–½è¨­ã‚±ã‚¢å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
            </p>
            <div class="mt-4 space-x-4">
                <a href="index.html" class="text-gray-400 hover:text-white transition">ãƒˆãƒƒãƒ—</a>
                <a href="https://github.com/yasushihonda-acg/facility-care-input-form" target="_blank"
                   class="text-gray-400 hover:text-white transition">GitHub</a>
                <a href="https://facility-care-input-form.web.app" target="_blank"
                   class="text-gray-400 hover:text-white transition">ãƒ‡ãƒ¢</a>
                <a href="https://facility-care-input-form.web.app/settings" target="_blank"
                   class="text-yellow-400 hover:text-yellow-300 transition">è¨­å®š</a>
            </div>
        </div>
    </footer>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                actorMargin: 50,
                messageMargin: 40
            }
        });
    </script>
</body>
</html>
